<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Snack Packz — Spin Select</title>
  <meta name="theme-color" content="#050710"/>
  <style>
    :root{
      --bg0:#040611;
      --bg1:#070A12;
      --txt:#EAF0FF;
      --mut:#9AA6C7;
      --line:rgba(255,255,255,.10);
      --shadow:0 18px 60px rgba(0,0,0,.55);
      --r:22px;

      --accent:#9BE7FF;
      --accent2:#B7A8FF;
      --hot:#FF6A3D;

      --wheelSize:min(68vmin, 560px);
      --hudW:min(42vw, 560px);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1200px 700px at 18% 12%, rgba(155,231,255,.10), transparent 60%),
        radial-gradient(1000px 800px at 82% 25%, rgba(183,168,255,.10), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }
    a{ color:inherit; text-decoration:none; }
    button{ font:inherit; }

    /* ===== BACKGROUND CAR ===== */
    .bg{
      position:fixed;
      inset:0;
      z-index:0;
      overflow:hidden;
      background: radial-gradient(1200px 700px at 30% 30%, rgba(155,231,255,.10), transparent 60%),
                  radial-gradient(1000px 700px at 70% 30%, rgba(183,168,255,.08), transparent 60%),
                  linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.55));
    }
    .bg img{
      position:absolute;
      right:-8vw;
      bottom:-8vh;
      width: min(1200px, 120vw);
      max-width:none;
      opacity:.75;
      filter: drop-shadow(0 35px 90px rgba(0,0,0,.85));
      transform: translateZ(0);
      pointer-events:none;
      user-select:none;
    }
    .bg:after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(900px 520px at 15% 10%, rgba(0,0,0,.10), transparent 60%),
        radial-gradient(900px 680px at 70% 25%, rgba(0,0,0,.22), transparent 65%),
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.62));
      pointer-events:none;
    }

    /* ===== TOP BAR ===== */
    .topbar{
      position:fixed;
      left:0; right:0; top:0;
      z-index:50;
      padding: 14px 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:14px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.12));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .brand{
      display:flex; align-items:center; gap:12px; min-width:0;
    }
    .logo{
      width:40px;height:40px;border-radius:14px;
      background:
        radial-gradient(14px 14px at 30% 30%, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(18px 18px at 70% 65%, rgba(155,231,255,.22), transparent 65%),
        linear-gradient(135deg, rgba(155,231,255,.25), rgba(183,168,255,.20));
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
      flex:0 0 auto;
    }
    .brandText{ min-width:0; }
    .brandText h1{
      margin:0;
      font-size: 15px;
      letter-spacing:.5px;
      font-weight: 900;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brandText p{
      margin:4px 0 0;
      font-size: 12px;
      color:rgba(234,240,255,.70);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .rightChips{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .chip, .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color: rgba(234,240,255,.90);
      border-radius: 999px;
      padding: 9px 12px;
      font-size: 12px;
      letter-spacing:.2px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .chip:hover, .btn:hover{
      transform: translateY(-1px);
      background: rgba(0,0,0,.28);
      border-color: rgba(255,255,255,.20);
    }
    .chip:active, .btn:active{ transform: translateY(0px) scale(.99); }
    .dot{
      width:7px;height:7px;border-radius:50%;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 4px rgba(155,231,255,.10);
    }

    /* ===== LAYOUT ===== */
    .scene{
      position:fixed;
      inset:0;
      z-index:10;
      padding-top: 72px;
      display:grid;
      grid-template-columns: 1fr var(--hudW);
      gap: clamp(12px, 2.2vw, 22px);
      align-items:stretch;
    }
    @media (max-width: 980px){
      body{ overflow:auto; }
      .scene{
        position:relative;
        padding-top: 76px;
        grid-template-columns: 1fr;
        overflow:auto;
      }
    }

    /* ===== LEFT: WHEEL ===== */
    .leftPane{
      position:relative;
      z-index:10;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: clamp(10px, 2vw, 18px);
    }
    .card{
      width: min(100%, 900px);
      border-radius: var(--r);
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      overflow:hidden;
      position:relative;
    }
    .card:before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(900px 350px at 20% 10%, rgba(155,231,255,.10), transparent 60%),
        radial-gradient(900px 350px at 80% 20%, rgba(183,168,255,.10), transparent 62%),
        radial-gradient(900px 450px at 50% 110%, rgba(118,255,209,.06), transparent 62%);
      opacity:.9;
      pointer-events:none;
    }
    .header{
      position:relative;
      z-index:2;
      padding: 16px 16px 12px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:14px;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .header h2{
      margin:0;
      font-size: 16px;
      font-weight: 950;
      letter-spacing:.5px;
    }
    .header p{
      margin:6px 0 0;
      font-size: 12.5px;
      color: rgba(234,240,255,.70);
      line-height:1.35;
    }
    .miniBtns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .wheelWrap{
      position:relative;
      z-index:2;
      padding: 14px 14px 16px;
      display:grid;
      grid-template-columns: 1fr 260px;
      gap: 14px;
      align-items:center;
    }
    @media (max-width: 900px){
      .wheelWrap{ grid-template-columns: 1fr; }
    }

    .wheelStage{
      position:relative;
      display:grid;
      place-items:center;
      min-height: calc(var(--wheelSize) + 20px);
      touch-action:none;
      user-select:none;
    }
    .wheelCore{
      position:relative;
      width: var(--wheelSize);
      height: var(--wheelSize);
      display:grid;
      place-items:center;
      transform: translateZ(0);
    }
    .wheelShadow{
      position:absolute;
      inset:-10%;
      border-radius:50%;
      background: radial-gradient(circle at 50% 55%, rgba(0,0,0,.55), transparent 60%);
      filter: blur(10px);
      opacity:.9;
      z-index:0;
      pointer-events:none;
    }
    .wheelImg{
      position:relative;
      width:100%;
      height:100%;
      object-fit:contain;
      transform: rotate(var(--rot, 0deg));
      will-change: transform;
      z-index:2;
      filter: drop-shadow(0 28px 70px rgba(0,0,0,.80));
      user-select:none;
      pointer-events:none;
    }

    /* subtle rim glow that ramps with speed (not tacky) */
    .rimGlow{
      position:absolute;
      inset:-3%;
      border-radius:50%;
      z-index:1;
      background:
        radial-gradient(circle at 50% 50%, transparent 52%, rgba(155,231,255,.10) 60%, transparent 75%),
        radial-gradient(circle at 50% 50%, transparent 55%, rgba(183,168,255,.08) 64%, transparent 78%);
      opacity: .55;
      filter: blur(0px);
      pointer-events:none;
      transition: opacity .12s ease;
    }

    /* markers around wheel */
    .markers{
      position:absolute;
      width: var(--wheelSize);
      height: var(--wheelSize);
      inset:0;
      margin:auto;
      z-index:5;
      pointer-events:auto;
    }
    .marker{
      position:absolute;
      left:50%; top:50%;
      height: 34px;
      transform-origin: 0% 50%;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:flex;
      align-items:center;
      gap:10px;
      padding: 0 12px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      box-shadow: 0 16px 50px rgba(0,0,0,.42);
      transition: transform .12s ease, border-color .12s ease, background .12s ease, box-shadow .12s ease;
      white-space:nowrap;
    }
    .marker:hover{
      border-color: rgba(255,255,255,.20);
      background: rgba(0,0,0,.28);
    }
    .marker.active{
      border-color: rgba(155,231,255,.32);
      box-shadow: 0 18px 60px rgba(0,0,0,.58);
    }
    .mDot{
      width:10px;height:10px;border-radius:50%;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 6px rgba(155,231,255,.10);
      flex:0 0 auto;
    }
    .mTxt{
      font-weight: 950;
      font-size: 12px;
      letter-spacing:.55px;
      text-transform: uppercase;
    }
    .mSub{
      margin-left:auto;
      font-size: 11px;
      color: rgba(234,240,255,.68);
      letter-spacing:.2px;
      text-transform: uppercase;
    }

    /* ===== SPEEDOMETER HUD (REAL IMAGE + LIVE NEEDLE + DIGITS) ===== */
    .speedPanel{
      align-self:stretch;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 14px 12px;
      display:flex;
      flex-direction:column;
      gap:12px;
      position:relative;
      overflow:hidden;
    }
    .speedPanel h3{
      margin:0;
      font-size: 12px;
      letter-spacing:.35px;
      color: rgba(234,240,255,.82);
      font-weight: 950;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .speedPanel h3 span{
      color: rgba(234,240,255,.62);
      font-weight: 800;
      font-size: 11px;
      letter-spacing:.2px;
    }

    .speedoStage{
      position:relative;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.16);
      overflow:hidden;
      box-shadow: 0 18px 60px rgba(0,0,0,.40);
      aspect-ratio: 16 / 10;
      display:grid;
      place-items:center;
    }
    .speedoStage img{
      width:100%;
      height:100%;
      object-fit: cover;
      opacity:.95;
      user-select:none;
      pointer-events:none;
      filter: contrast(1.05) saturate(1.05);
    }

    /* needle overlay */
    .needle{
      position:absolute;
      left:50%;
      top:58%;
      width: 46%;
      height: 3px;
      transform-origin: 8% 50%;
      transform: translate(-8%, -50%) rotate(var(--needle, -60deg));
      background: linear-gradient(90deg, rgba(255,255,255,.85), rgba(255,106,61,.85));
      box-shadow: 0 0 18px rgba(255,106,61,.22);
      border-radius: 999px;
      opacity:.92;
    }
    .needle:after{
      content:"";
      position:absolute;
      left:6%;
      top:50%;
      width: 12px;
      height: 12px;
      transform: translate(-50%,-50%);
      border-radius: 50%;
      background: radial-gradient(circle at 35% 30%, rgba(255,255,255,.35), rgba(0,0,0,.55));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 10px 24px rgba(0,0,0,.40);
    }

    /* digits panel (clean, not cheesy) */
    .digits{
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .digitBox{
      flex:1;
      min-width: 120px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding: 10px 12px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .digitBox .k{
      font-size: 11px;
      color: rgba(234,240,255,.65);
      letter-spacing:.2px;
    }
    .digitBox .v{
      margin-top: 6px;
      font-size: 20px;
      font-weight: 950;
      letter-spacing:.6px;
      line-height:1;
    }
    .digitBox .u{
      margin-top: 6px;
      font-size: 11px;
      color: rgba(234,240,255,.60);
      letter-spacing:.2px;
    }

    .panelBtns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .panelBtns .btn{
      flex:1;
      justify-content:center;
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 900;
    }

    /* flame vfx - restrained + clean */
    .flameFX{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:8;
      opacity:0;
      transition: opacity .16s ease;
      mix-blend-mode: screen;
    }
    .flameFX.on{ opacity:1; }
    .flameFX:before,
    .flameFX:after{
      content:"";
      position:absolute;
      left:50%; top:50%;
      width: 42%;
      height: 42%;
      transform: translate(-50%,-50%);
      border-radius: 50%;
      background:
        radial-gradient(circle at 50% 65%, rgba(255,106,61,.45), transparent 62%),
        radial-gradient(circle at 45% 42%, rgba(255,210,122,.26), transparent 60%),
        radial-gradient(circle at 55% 30%, rgba(255,255,255,.18), transparent 60%);
      animation: spin 420ms linear infinite;
      filter: blur(1px);
      opacity:.9;
    }
    .flameFX:after{
      width: 56%;
      height: 56%;
      filter: blur(8px);
      opacity:.55;
      animation-duration: 320ms;
    }
    @keyframes spin{
      from{ transform: translate(-50%,-50%) rotate(0deg); }
      to{ transform: translate(-50%,-50%) rotate(360deg); }
    }

    /* ===== RIGHT: PREVIEW HUD ===== */
    .hud{
      position:relative;
      z-index:10;
      border-left:1px solid rgba(255,255,255,.06);
      padding: clamp(10px, 2vw, 16px);
      display:flex;
      align-items:stretch;
    }
    @media (max-width: 980px){ .hud{ border-left:none; } }

    .hudCard{
      width:100%;
      border-radius: var(--r);
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      position:relative;
      min-height: 420px;
    }
    @media (max-width: 980px){ .hudCard{ min-height: 360px; } }

    .hudMedia{
      position:absolute; inset:0; z-index:2;
    }
    .hudMedia img, .hudMedia video{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit: cover;
      transform: scale(1.02);
      filter: contrast(1.05) saturate(1.03);
    }
    .hudMedia img{ opacity:1; transition: opacity 220ms ease; }
    .hudMedia video{ opacity:0; transition: opacity 320ms ease; }
    .hudMedia.ready video{ opacity:1; }
    .hudMedia.ready img{ opacity:0; }

    .hudShade{
      position:absolute; inset:0; z-index:3;
      background:
        radial-gradient(700px 380px at 20% 10%, rgba(0,0,0,.12), transparent 60%),
        radial-gradient(800px 520px at 70% 35%, rgba(0,0,0,.26), transparent 65%),
        linear-gradient(180deg, rgba(0,0,0,.08), rgba(0,0,0,.66));
      pointer-events:none;
    }

    .hudTop{
      position:relative; z-index:5;
      padding: 16px 16px 0;
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:flex-start;
    }
    .hudTitle h3{
      margin:0;
      font-size: 18px;
      font-weight: 950;
      letter-spacing:.5px;
      text-shadow: 0 18px 50px rgba(0,0,0,.65);
    }
    .hudTitle p{
      margin: 6px 0 0;
      font-size: 12.5px;
      color: rgba(234,240,255,.78);
      line-height:1.35;
      text-shadow: 0 18px 50px rgba(0,0,0,.65);
      max-width: 46ch;
    }

    .enter{
      border-radius: 16px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.26);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      font-size: 12px;
      font-weight: 950;
      letter-spacing:.25px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      white-space:nowrap;
    }
    .enter:hover{ transform: translateY(-1px); background: rgba(0,0,0,.32); border-color: rgba(155,231,255,.22); }
    .enter:active{ transform: translateY(0px) scale(.99); }
    .spark{
      width:18px;height:18px;border-radius:10px;
      background: linear-gradient(180deg, rgba(155,231,255,.90), rgba(183,168,255,.82));
      box-shadow: 0 0 0 6px rgba(155,231,255,.10);
      border:1px solid rgba(255,255,255,.12);
    }

    .hudBottom{
      position:absolute;
      left:0; right:0; bottom:0;
      z-index:6;
      padding: 14px 16px 16px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:flex-end;
    }
    .hudStat{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      border-radius: 16px;
      padding: 10px 12px;
      max-width: 62%;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .hudStat .k{ font-size: 11px; color: rgba(234,240,255,.70); letter-spacing:.2px; }
    .hudStat .v{ margin-top: 5px; font-size: 12.5px; font-weight: 950; letter-spacing:.25px; }
    .hudTip{
      text-align:right;
      font-size: 11px;
      color: rgba(234,240,255,.70);
      line-height:1.25;
      text-shadow: 0 18px 50px rgba(0,0,0,.65);
    }

    .tapHint{
      display:none;
      margin-top: 10px;
      font-size: 12px;
      color: rgba(234,240,255,.72);
    }
    @media (hover:none){ .tapHint{ display:block; } }

    .foot{
      position:relative;
      z-index:2;
      padding: 10px 16px 14px;
      border-top:1px solid rgba(255,255,255,.06);
      font-size: 11px;
      color: rgba(234,240,255,.60);
    }
  </style>
</head>
<body>

  <!-- Background -->
  <div class="bg" aria-hidden="true">
    <img src="assets/car.png" alt=""/>
  </div>

  <!-- Top bar -->
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div class="brandText">
        <h1>Snack Packz</h1>
        <p>Spin the wheel. Flex the speed. Pick your vibe.</p>
      </div>
    </div>
    <div class="rightChips">
      <div class="chip"><span class="dot"></span> Drag • Scroll • Snap</div>
      <a class="chip" id="waTop" href="#" rel="noopener">WhatsApp Order</a>
    </div>
  </div>

  <div class="scene">
    <!-- LEFT -->
    <div class="leftPane">
      <div class="card">
        <div class="header">
          <div>
            <h2>Spin Select</h2>
            <p>Real wheel + real speedometer. Try spin it fast — it’ll show your speed live.</p>
            <div class="tapHint">Mobile: tap a vibe once to preview, tap again to enter.</div>
          </div>
          <div class="miniBtns">
            <button class="btn" id="resetBtn" type="button">Reset</button>
            <button class="btn" id="boostBtn" type="button">Boost</button>
          </div>
        </div>

        <div class="wheelWrap">
          <!-- Wheel stage -->
          <div class="wheelStage" id="wheelStage">
            <div class="wheelCore" id="wheelCore">
              <div class="wheelShadow"></div>
              <div class="rimGlow" id="rimGlow"></div>
              <img class="wheelImg" id="wheelImg" src="assets/wheel.png" alt="Wheel"/>
              <div class="markers" id="markers" aria-label="markers"></div>
            </div>
          </div>

          <!-- Speedo panel -->
          <div class="speedPanel">
            <h3>SPIN SPEED <span id="rankTxt">Rank: Warm</span></h3>

            <div class="speedoStage">
              <img src="assets/speedo.png" alt="Speedometer"/>
              <div class="needle" id="needle" style="--needle:-60deg;"></div>
              <div class="flameFX" id="flameFX"></div>
            </div>

            <div class="digits">
              <div class="digitBox">
                <div class="k">Speed</div>
                <div class="v" id="spdVal">0</div>
                <div class="u">SPIN / SEC</div>
              </div>
              <div class="digitBox">
                <div class="k">Peak</div>
                <div class="v" id="peakVal">0</div>
                <div class="u">TOP HIT</div>
              </div>
            </div>

            <div class="panelBtns">
              <button class="btn" id="brakeBtn" type="button">Brake</button>
              <button class="btn" id="autoBtn" type="button">Auto</button>
            </div>
          </div>
        </div>

        <div class="foot">Tip: click/tap a vibe label to snap instantly. Drag the wheel to throw it.</div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="hud">
      <div class="hudCard">
        <div class="hudMedia" id="hudMedia" aria-hidden="true">
          <img id="hudImg" src="assets/gym.jpg" alt=""/>
          <video id="hudVid" muted playsinline loop preload="metadata"></video>
        </div>
        <div class="hudShade" aria-hidden="true"></div>

        <div class="hudTop">
          <div class="hudTitle">
            <h3 id="hudTitle">GYM</h3>
            <p id="hudDesc">High focus. Clean fuel. No distractions.</p>
          </div>
          <a class="enter" id="enterBtn" href="gym.html">
            <span class="spark" aria-hidden="true"></span>
            Enter
          </a>
        </div>

        <div class="hudBottom">
          <div class="hudStat">
            <div class="k">Preview</div>
            <div class="v" id="hudMeta">Image → Video</div>
          </div>
          <div class="hudTip">
            Drag to spin<br/>Scroll to flick<br/>Tap twice on mobile
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========= CONFIG =========
    const WHATSAPP_NUMBER = "447483849357"; // no + in wa.me
    const vibes = [
      { key:"gym",     label:"GYM",     sub:"FOCUS", page:"gym.html",     img:"assets/gym.jpg",     vid:"assets/gym.mp4",     desc:"High focus. Clean fuel. No distractions.", meta:"Heavy session snack packs." },
      { key:"lockin",  label:"LOCK-IN", sub:"GRIND", page:"lock-in.html", img:"assets/lockin.jpg",  vid:"assets/lockin.mp4",  desc:"Tunnel vision mode. Phone down. Get it done.", meta:"Study / deep work packs." },
      { key:"work",    label:"WORK",    sub:"DAY",   page:"work.html",    img:"assets/work.jpg",    vid:"assets/work.mp4",    desc:"Clean energy. Smooth day. No crash.", meta:"Office-ready packs." },
      { key:"gaming",  label:"GAMING",  sub:"NIGHT", page:"gaming.html",  img:"assets/gaming.jpg",  vid:"assets/gaming.mp4",  desc:"Locked in. Fast hands. Zero tilt.", meta:"Late-night packs." },
      { key:"mystery", label:"MYSTERY", sub:"DROP",  page:"mystery.html", img:"assets/mystery.jpg", vid:"assets/mystery.mp4", desc:"Random pull. Premium chaos (in a good way).", meta:"Surprise packs." },
      { key:"fresh",   label:"FRESH",   sub:"CLEAN", page:"fresh.html",   img:"assets/fresh.jpg",   vid:"assets/fresh.mp4",   desc:"Light, clean, refreshing. Reset the day.", meta:"Fresh & fruity packs." },
    ];

    const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

    function waLink(text){
      return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;
    }

    // ========= DOM =========
    document.getElementById("waTop").href = waLink("Hi Snack Packz — I want to place an order.");

    const wheelStage = document.getElementById("wheelStage");
    const wheelCore  = document.getElementById("wheelCore");
    const wheelImg   = document.getElementById("wheelImg");
    const markers    = document.getElementById("markers");
    const rimGlow    = document.getElementById("rimGlow");

    const resetBtn = document.getElementById("resetBtn");
    const boostBtn = document.getElementById("boostBtn");
    const brakeBtn = document.getElementById("brakeBtn");
    const autoBtn  = document.getElementById("autoBtn");

    const needle  = document.getElementById("needle");
    const spdVal  = document.getElementById("spdVal");
    const peakVal = document.getElementById("peakVal");
    const flameFX = document.getElementById("flameFX");
    const rankTxt = document.getElementById("rankTxt");

    const hudMedia = document.getElementById("hudMedia");
    const hudImg   = document.getElementById("hudImg");
    const hudVid   = document.getElementById("hudVid");
    const hudTitle = document.getElementById("hudTitle");
    const hudDesc  = document.getElementById("hudDesc");
    const hudMeta  = document.getElementById("hudMeta");
    const enterBtn = document.getElementById("enterBtn");

    // ========= STATE =========
    const N = vibes.length;
    const step = 360 / N;

    let rot = 0;               // degrees
    let vel = 0;               // deg/sec
    let dragging = false;
    let pointerId = null;
    let lastAng = 0;
    let lastT = 0;

    let activeIndex = 0;
    let autoSpin = false;

    let peak = 0;              // peak "spin/sec"
    let token = 0;

    // ========= PREVIEW (image instant -> fade to video) =========
    function loadPreview(v){
      hudTitle.textContent = v.label;
      hudDesc.textContent = v.desc;
      hudMeta.textContent = "Image → Video";
      enterBtn.href = v.page;

      hudMedia.classList.remove("ready");
      hudImg.src = v.img;

      const t = ++token;
      try{ hudVid.pause(); }catch(e){}
      hudVid.removeAttribute("src");
      hudVid.load();
      hudVid.src = v.vid;

      const onReady = () => {
        if (t !== token) return;
        hudMedia.classList.add("ready");
        hudMeta.textContent = "Video ready";
        try{ hudVid.play().catch(()=>{}); }catch(e){}
      };
      const onError = () => {
        if (t !== token) return;
        hudMedia.classList.remove("ready");
        hudMeta.textContent = "Video unavailable (image only)";
      };

      hudVid.addEventListener("loadeddata", onReady, {once:true});
      hudVid.addEventListener("canplaythrough", onReady, {once:true});
      hudVid.addEventListener("error", onError, {once:true});
      hudVid.load();
    }

    // ========= SNAP MATH =========
    function normDeg(d){
      d %= 360;
      if (d < 0) d += 360;
      return d;
    }

    function nearestIndex(){
      // want index to be at top (0deg). Marker positions are fixed at i*step - 90,
      // so our "top snap" is just nearest multiple of step to rot.
      // We'll treat "index 0 at top when rot is 0".
      const r = normDeg(rot);
      // index i is aligned when rot ≈ -i*step
      let i = Math.round((-r) / step);
      i = ((i % N) + N) % N;
      return i;
    }

    function snapToIndex(i){
      const target = -i * step;
      // shortest path diff
      let diff = target - rot;
      diff = ((diff + 540) % 360) - 180;
      rot += diff;
      vel = 0;
    }

    function setActive(i, snap=true){
      activeIndex = i;
      updateMarkerActive();
      loadPreview(vibes[i]);
      if (snap) snapToIndex(i);
    }

    // ========= MARKERS UI =========
    function buildMarkers(){
      markers.innerHTML = "";
      const radiusPct = 48; // distance from centre
      for (let i=0; i<N; i++){
        const m = document.createElement("div");
        m.className = "marker";
        m.dataset.index = String(i);

        const wide = vibes[i].label.length > 6 ? 148 : 128;
        m.style.width = wide + "px";

        const deg = (i * step) - 90; // put index 0 at top
        m.style.transform = `rotate(${deg}deg) translateX(${radiusPct}%)`;

        m.innerHTML = `
          <span class="mDot" aria-hidden="true"></span>
          <span class="mTxt">${vibes[i].label}</span>
          <span class="mSub">${vibes[i].sub}</span>
        `;

        m.addEventListener("mouseenter", ()=>{
          if (window.matchMedia("(hover:hover)").matches){
            setActive(i, false);
          }
        });

        m.addEventListener("click", (e)=>{
          e.preventDefault();
          const idx = Number(m.dataset.index);

          // mobile: first tap preview, second tap enter
          if (window.matchMedia("(hover:none)").matches){
            if (activeIndex === idx && m.classList.contains("active")){
              window.location.href = vibes[idx].page;
              return;
            }
            setActive(idx, true);
            return;
          }

          // desktop snap
          setActive(idx, true);
        }, {passive:false});

        markers.appendChild(m);
      }
      updateMarkerActive();
    }

    function updateMarkerActive(){
      markers.querySelectorAll(".marker").forEach(el=>el.classList.remove("active"));
      const el = markers.querySelector(`.marker[data-index="${activeIndex}"]`);
      if (el) el.classList.add("active");
    }

    // ========= INPUT (DRAG) =========
    function angleFromEvent(e){
      const rect = wheelCore.getBoundingClientRect();
      const cx = rect.left + rect.width/2;
      const cy = rect.top + rect.height/2;
      const dx = e.clientX - cx;
      const dy = e.clientY - cy;
      return Math.atan2(dy, dx) * 180 / Math.PI;
    }

    function onDown(e){
      dragging = true;
      pointerId = e.pointerId;
      wheelStage.setPointerCapture?.(pointerId);
      lastAng = angleFromEvent(e);
      lastT = performance.now();
    }

    function onMove(e){
      if (!dragging || e.pointerId !== pointerId) return;
      const a = angleFromEvent(e);
      let da = a - lastAng;
      if (da > 180) da -= 360;
      if (da < -180) da += 360;

      rot += da;

      const now = performance.now();
      const dt = Math.max(1, (now - lastT)) / 1000;
      const v = da / dt;
      vel = vel * 0.75 + v * 0.25;

      lastAng = a;
      lastT = now;

      const idx = nearestIndex();
      if (idx !== activeIndex){
        activeIndex = idx;
        updateMarkerActive();
        loadPreview(vibes[idx]);
      }
    }

    function onUp(e){
      if (!dragging || e.pointerId !== pointerId) return;
      dragging = false;
      pointerId = null;

      // snap shortly after release (feels game-like)
      setTimeout(()=>{
        const idx = nearestIndex();
        setActive(idx, true);
      }, 70);
    }

    // wheel scroll flick
    function onWheel(e){
      e.preventDefault();
      const delta = e.deltaY || 0;
      const add = clamp(delta * 0.16, -35, 35);
      rot += add;
      vel += add * 6;

      const idx = nearestIndex();
      if (idx !== activeIndex){
        activeIndex = idx;
        updateMarkerActive();
        loadPreview(vibes[idx]);
      }

      clearTimeout(onWheel._t);
      onWheel._t = setTimeout(()=>{
        const idx2 = nearestIndex();
        setActive(idx2, true);
      }, 110);
    }

    // ========= SPEEDOMETER LOGIC =========
    function setSpeedUI(spinPerSec){
      const s = Math.max(0, spinPerSec);
      spdVal.textContent = String(Math.round(s));
      peak = Math.max(peak, s);
      peakVal.textContent = String(Math.round(peak));

      // needle angle mapping: 0 -> -60deg, 100 -> +110deg
      const needleDeg = -60 + clamp(s, 0, 100) * (170/100);
      needle.style.setProperty("--needle", `${needleDeg}deg`);

      // rank
      let rank = "Warm";
      if (s >= 25) rank = "Hot";
      if (s >= 50) rank = "Flame";
      if (s >= 75) rank = "Overdrive";
      rankTxt.textContent = `Rank: ${rank}`;

      // flame + rim glow ramp
      const flameOn = s >= 45;
      flameFX.classList.toggle("on", flameOn);

      // subtle glow, not circus
      rimGlow.style.opacity = (0.45 + clamp(s/120, 0, 0.55)).toFixed(2);
    }

    // ========= BUTTONS =========
    resetBtn.addEventListener("click", ()=>{
      autoSpin = false;
      vel = 0;
      peak = 0;
      setActive(0, true);
    });

    boostBtn.addEventListener("click", ()=>{
      // quick extra fling
      vel += 1800;
    });

    brakeBtn.addEventListener("click", ()=>{
      autoSpin = false;
      vel *= 0.12;
      setTimeout(()=>{
        const idx = nearestIndex();
        setActive(idx, true);
      }, 80);
    });

    autoBtn.addEventListener("click", ()=>{
      autoSpin = !autoSpin;
      autoBtn.textContent = autoSpin ? "Auto: ON" : "Auto";
    });

    // ========= ANIMATION LOOP =========
    let lastFrame = performance.now();
    function tick(now){
      const dt = Math.min(0.05, (now - lastFrame) / 1000);
      lastFrame = now;

      if (autoSpin) vel += 420 * dt;

      if (!dragging){
        rot += vel * dt;
        // friction
        vel *= Math.exp(-3.1 * dt);

        // when nearly stopped, softly settle to snap
        if (Math.abs(vel) < 20){
          const idx = nearestIndex();
          const target = -idx * step;
          let diff = target - rot;
          diff = ((diff + 540) % 360) - 180;
          rot += diff * Math.min(1, dt * 8);

          if (idx !== activeIndex){
            activeIndex = idx;
            updateMarkerActive();
            loadPreview(vibes[idx]);
          }
        }
      }

      // apply rotation
      wheelImg.style.setProperty("--rot", `${rot}deg`);

      // speed from deg/sec -> "spin/sec"
      // 360 deg/sec = 1 spin/sec. Multiply for a more dramatic number.
      const spinPerSec = Math.abs(vel) / 360 * 42;
      setSpeedUI(spinPerSec);

      requestAnimationFrame(tick);
    }

    // ========= INIT =========
    buildMarkers();
    setActive(0, true);
    requestAnimationFrame(tick);

    wheelStage.addEventListener("pointerdown", onDown, {passive:true});
    window.addEventListener("pointermove", onMove, {passive:true});
    window.addEventListener("pointerup", onUp, {passive:true});
    wheelStage.addEventListener("wheel", onWheel, {passive:false});
  </script>
</body>
</html>
