<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Snack Packz — Vibes</title>
  <meta name="theme-color" content="#070A12" />
  <style>
    :root{
      --bg:#050710;
      --bg2:#070A12;
      --txt:#EAF0FF;
      --mut:#9AA6C7;
      --line:rgba(255,255,255,.10);
      --glass:rgba(12,16,30,.56);
      --glass2:rgba(12,16,30,.38);
      --shadow:0 18px 60px rgba(0,0,0,.55);
      --radius:22px;
      --ringSize:min(72vmin, 520px);
      --previewW:min(46vw, 560px);
      --accent:#9BE7FF;
      --accent2:#B7A8FF;
      --good:#76FFD1;
      --warn:#FFD27A;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1000px 600px at 15% 10%, rgba(155,231,255,.12), transparent 55%),
        radial-gradient(900px 700px at 80% 25%, rgba(183,168,255,.10), transparent 60%),
        radial-gradient(1000px 900px at 50% 110%, rgba(118,255,209,.06), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      overflow-x:hidden;
    }

    a{ color:inherit; text-decoration:none; }

    .wrap{
      min-height:100%;
      padding: clamp(14px, 2.5vw, 28px);
      padding-bottom: 34px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    /* Top bar */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding: 12px 14px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 0;
    }
    .logo{
      width:38px;height:38px;border-radius:14px;
      background:
        radial-gradient(14px 14px at 30% 30%, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(18px 18px at 70% 65%, rgba(155,231,255,.22), transparent 65%),
        linear-gradient(135deg, rgba(155,231,255,.25), rgba(183,168,255,.20));
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
    }
    .brand h1{
      margin:0;
      font-size: 15px;
      letter-spacing:.5px;
      font-weight: 700;
      line-height: 1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand p{
      margin:0;
      font-size: 12px;
      color:var(--mut);
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .hint{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .chip{
      font-size:12px;
      color: rgba(234,240,255,.86);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      border-radius: 999px;
      padding: 7px 10px;
      display:flex;
      align-items:center;
      gap:8px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .dot{
      width:7px;height:7px;border-radius:50%;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 4px rgba(155,231,255,.10);
    }

    /* Main layout */
    .main{
      flex:1;
      display:grid;
      grid-template-columns: 1fr var(--previewW);
      gap: clamp(14px, 2.2vw, 22px);
      align-items:center;
    }

    @media (max-width: 980px){
      .main{
        grid-template-columns: 1fr;
        align-items:start;
      }
    }

    /* Ring zone */
    .ringZone{
      position:relative;
      display:flex;
      justify-content:center;
      align-items:center;
      padding: clamp(10px, 1.5vw, 14px);
    }

    .ringCard{
      width: min(100%, 720px);
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: clamp(14px, 2.2vw, 18px);
      position:relative;
      overflow:hidden;
    }

    .ringCard:before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(600px 250px at 20% 10%, rgba(155,231,255,.10), transparent 55%),
        radial-gradient(650px 280px at 85% 25%, rgba(183,168,255,.10), transparent 60%),
        radial-gradient(700px 320px at 45% 110%, rgba(118,255,209,.06), transparent 60%);
      pointer-events:none;
      opacity:.9;
    }

    .ringTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      position:relative;
      z-index:2;
      margin-bottom: 10px;
    }

    .ringTop .title{
      min-width:0;
    }
    .ringTop h2{
      margin:0;
      font-size: 16px;
      letter-spacing:.4px;
      font-weight: 750;
    }
    .ringTop p{
      margin:5px 0 0;
      font-size: 12.5px;
      color: var(--mut);
      line-height: 1.35;
    }

    .ctaMini{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color: rgba(234,240,255,.92);
      border-radius: 14px;
      padding: 9px 11px;
      font-size: 12px;
      letter-spacing:.2px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(0,0,0,.28); border-color: rgba(255,255,255,.20); }
    .btn:active{ transform: translateY(0px) scale(.99); }
    .btn .ic{
      width:18px;height:18px;border-radius:9px;
      background: linear-gradient(180deg, rgba(155,231,255,.30), rgba(183,168,255,.22));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 8px 20px rgba(0,0,0,.22);
    }

    /* Donut itself */
    .donutWrap{
      position:relative;
      display:grid;
      place-items:center;
      height: calc(var(--ringSize) + 70px);
      margin-top: 4px;
      z-index:2;
      touch-action: none; /* we handle pan ourselves */
    }

    .donut{
      width: var(--ringSize);
      height: var(--ringSize);
      position:relative;
      border-radius:50%;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.55));
    }

    .donut:before{
      /* Outer glow ring */
      content:"";
      position:absolute; inset:-10px;
      border-radius:50%;
      background:
        radial-gradient(circle at 50% 50%, rgba(155,231,255,.10), transparent 55%),
        conic-gradient(from 0deg,
          rgba(155,231,255,.12),
          rgba(183,168,255,.11),
          rgba(118,255,209,.08),
          rgba(255,210,122,.07),
          rgba(155,231,255,.12)
        );
      -webkit-mask:
        radial-gradient(circle at 50% 50%, transparent 54%, #000 56%, #000 75%, transparent 78%);
              mask:
        radial-gradient(circle at 50% 50%, transparent 54%, #000 56%, #000 75%, transparent 78%);
      opacity:.9;
    }

    .ring{
      position:absolute; inset:0;
      border-radius:50%;
      transform: rotate(var(--rot, 0deg));
      transition: transform 160ms cubic-bezier(.2,.9,.2,1);
      will-change: transform;
    }
    .dragging .ring{ transition:none; }

    .center{
      position:absolute;
      width: 44%;
      height: 44%;
      border-radius:50%;
      left:50%; top:50%;
      transform: translate(-50%,-50%);
      background:
        radial-gradient(40% 40% at 35% 35%, rgba(255,255,255,.18), transparent 65%),
        radial-gradient(40% 40% at 65% 70%, rgba(155,231,255,.14), transparent 70%),
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.45));
      border:1px solid rgba(255,255,255,.16);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.06),
        0 18px 50px rgba(0,0,0,.45);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 12px;
      text-align:center;
      pointer-events:none;
      z-index:4;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .center .big{
      font-weight: 800;
      letter-spacing:.7px;
      font-size: clamp(14px, 2.4vmin, 18px);
      margin:0;
    }
    .center .small{
      margin: 7px 0 0;
      color: rgba(234,240,255,.80);
      font-size: 12px;
      line-height: 1.25;
    }

    .selectorTick{
      position:absolute;
      left:50%;
      top: -6px;
      transform: translateX(-50%);
      width: 44px;
      height: 20px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.16);
      z-index:5;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .selectorTick:before{
      content:"";
      width:10px;height:10px;border-radius:50%;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 6px rgba(155,231,255,.10);
    }
    .selectorTick:after{
      content:"";
      width:10px;height:10px;border-radius:50%;
      background: rgba(255,255,255,.10);
    }

    .seg{
      position:absolute;
      left:50%; top:50%;
      width: 44%;
      height: 18%;
      transform-origin: 0% 50%;
      transform: rotate(var(--ang)) translateX(46%);
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background:
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:flex;
      align-items:center;
      justify-content:flex-start;
      padding: 10px 12px;
      gap:10px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      z-index:3;
      transition: transform 140ms ease, border-color 140ms ease, background 140ms ease, box-shadow 140ms ease;
      overflow:hidden;
    }

    .seg:before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(220px 90px at 15% 20%, rgba(155,231,255,.12), transparent 60%),
        radial-gradient(260px 110px at 85% 75%, rgba(183,168,255,.10), transparent 65%);
      opacity:.9;
      pointer-events:none;
    }

    .seg:hover{
      border-color: rgba(255,255,255,.22);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }

    .seg.active{
      border-color: rgba(155,231,255,.34);
      box-shadow: 0 14px 40px rgba(0,0,0,.34);
    }

    .pill{
      position:relative;
      z-index:2;
      width: 12px;
      height: 12px;
      border-radius:50%;
      background: linear-gradient(180deg, rgba(155,231,255,.92), rgba(183,168,255,.82));
      box-shadow: 0 0 0 6px rgba(155,231,255,.10);
      flex:0 0 auto;
    }

    .seg .label{
      position:relative;
      z-index:2;
      font-weight: 750;
      letter-spacing:.55px;
      font-size: 12px;
      line-height:1;
      text-transform: uppercase;
      white-space:nowrap;
    }

    .seg .sub{
      position:relative;
      z-index:2;
      margin-left:auto;
      font-size: 11px;
      color: rgba(234,240,255,.78);
      letter-spacing:.2px;
      white-space:nowrap;
      opacity:.95;
    }

    /* Preview panel */
    .preview{
      position:relative;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      overflow:hidden;
      min-height: 420px;
      align-self:stretch;
    }

    @media (max-width: 980px){
      .preview{ min-height: 360px; }
    }

    .preview:before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(700px 240px at 20% 10%, rgba(155,231,255,.10), transparent 58%),
        radial-gradient(700px 260px at 80% 18%, rgba(183,168,255,.10), transparent 60%),
        radial-gradient(700px 320px at 50% 110%, rgba(118,255,209,.08), transparent 60%);
      pointer-events:none;
      opacity:.85;
      z-index:1;
    }

    .mediaStage{
      position:absolute;
      inset:0;
      z-index:2;
      display:grid;
      place-items:center;
    }

    .mediaStage .img,
    .mediaStage video{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      transform: scale(1.02);
      filter: contrast(1.04) saturate(1.03);
    }

    .mediaStage .img{
      opacity:1;
      transition: opacity 220ms ease;
    }

    .mediaStage video{
      opacity:0;
      transition: opacity 320ms ease;
    }

    .mediaStage.ready video{ opacity:1; }
    .mediaStage.ready .img{ opacity:0; }

    .overlay{
      position:absolute;
      inset:0;
      z-index:3;
      background:
        radial-gradient(500px 280px at 25% 10%, rgba(0,0,0,.10), transparent 55%),
        radial-gradient(600px 420px at 70% 40%, rgba(0,0,0,.22), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.05), rgba(0,0,0,.52));
      pointer-events:none;
    }

    .previewTop{
      position:relative;
      z-index:4;
      padding: 16px 16px 0;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }

    .vTitle{
      min-width:0;
    }
    .vTitle h3{
      margin:0;
      font-size: 18px;
      letter-spacing:.4px;
      font-weight: 820;
      text-shadow: 0 14px 40px rgba(0,0,0,.55);
    }
    .vTitle p{
      margin: 6px 0 0;
      color: rgba(234,240,255,.80);
      font-size: 12.5px;
      line-height:1.35;
      text-shadow: 0 14px 40px rgba(0,0,0,.55);
    }

    .enterBtn{
      position:relative;
      z-index:4;
      border-radius: 16px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      font-size: 12px;
      font-weight: 700;
      letter-spacing:.25px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .enterBtn:hover{ transform: translateY(-1px); background: rgba(0,0,0,.30); border-color: rgba(155,231,255,.24); }
    .enterBtn:active{ transform: translateY(0px) scale(.99); }
    .enterBtn .spark{
      width:18px;height:18px;border-radius:10px;
      background: linear-gradient(180deg, rgba(155,231,255,.90), rgba(183,168,255,.82));
      box-shadow: 0 0 0 6px rgba(155,231,255,.10);
    }

    .previewBottom{
      position:absolute;
      left:0; right:0; bottom:0;
      z-index:4;
      padding: 14px 16px 16px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
    }

    .micro{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      border-radius: 16px;
      padding: 10px 12px;
      max-width: 62%;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .micro .k{
      font-size: 11px;
      color: rgba(234,240,255,.75);
      letter-spacing:.2px;
    }
    .micro .v{
      margin-top: 5px;
      font-size: 12.5px;
      font-weight: 750;
      letter-spacing:.25px;
    }

    .tip{
      text-align:right;
      font-size: 11px;
      color: rgba(234,240,255,.72);
      line-height:1.25;
      text-shadow: 0 12px 32px rgba(0,0,0,.50);
    }

    /* Mobile tap helper */
    .tapHint{
      display:none;
      margin-top: 10px;
      font-size: 12px;
      color: rgba(234,240,255,.76);
    }
    @media (hover:none){
      .tapHint{ display:block; }
    }

    /* Footer */
    .foot{
      margin-top: 6px;
      color: rgba(234,240,255,.62);
      font-size: 11px;
      text-align:center;
      letter-spacing:.2px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div style="min-width:0">
          <h1>Snack Packz</h1>
          <p>Spin the ring. Pick your vibe. Order fast.</p>
        </div>
      </div>
      <div class="hint">
        <div class="chip"><span class="dot"></span> Drag • Wheel • Tap • Snap</div>
        <a class="chip" id="waTop" href="#" rel="noopener">WhatsApp Order</a>
      </div>
    </div>

    <div class="main">
      <!-- Ring -->
      <div class="ringZone">
        <div class="ringCard" id="ringCard">
          <div class="ringTop">
            <div class="title">
              <h2>Choose your vibe</h2>
              <p>Hover or tap a vibe for a premium preview (image first, then video). Click to snap it instantly.</p>
              <div class="tapHint">Mobile: tap once to preview, tap again to enter.</div>
            </div>
            <div class="ctaMini">
              <button class="btn" id="resetBtn" type="button" title="Reset ring">
                <span class="ic" aria-hidden="true"></span> Reset
              </button>
              <button class="btn" id="spinBtn" type="button" title="Quick spin">
                <span class="ic" aria-hidden="true"></span> Quick spin
              </button>
            </div>
          </div>

          <div class="donutWrap" id="donutWrap">
            <div class="donut" id="donut">
              <div class="selectorTick" aria-hidden="true"></div>

              <div class="ring" id="ring" style="--rot: 0deg;">
                <!-- segments injected by JS -->
              </div>

              <div class="center">
                <div>
                  <p class="big" id="centerBig">G Y M</p>
                  <p class="small" id="centerSmall">Tap a vibe to preview. Drag the ring to switch fast.</p>
                </div>
              </div>
            </div>
          </div>

          <div class="foot">Tip: click any vibe to snap it to the top instantly — no slow rotation.</div>
        </div>
      </div>

      <!-- Preview -->
      <div class="preview" id="preview">
        <div class="mediaStage" id="mediaStage" aria-hidden="true">
          <img class="img" id="prevImg" src="assets/gym.jpg" alt="" />
          <video id="prevVid" muted playsinline loop preload="metadata"></video>
        </div>
        <div class="overlay" aria-hidden="true"></div>

        <div class="previewTop">
          <div class="vTitle">
            <h3 id="prevTitle">GYM</h3>
            <p id="prevDesc">High focus. Clean fuel. No distractions.</p>
          </div>
          <a class="enterBtn" id="enterBtn" href="gym.html">
            <span class="spark" aria-hidden="true"></span>
            Enter vibe
          </a>
        </div>

        <div class="previewBottom">
          <div class="micro">
            <div class="k">Preview</div>
            <div class="v" id="prevMeta">Image → Video fade (ready)</div>
          </div>
          <div class="tip" id="tipRight">
            Drag to spin<br/>Wheel scroll works<br/>Tap twice on mobile
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========= CONFIG =========
    const WHATSAPP_NUMBER = "447483849357"; // no + for wa.me
    const vibes = [
      {
        key: "gym",
        label: "GYM",
        sub: "FOCUS",
        page: "gym.html",
        img: "assets/gym.jpg",
        vid: "assets/gym.mp4",
        desc: "High focus. Clean fuel. No distractions.",
        meta: "Heavy session snack packs."
      },
      {
        key: "lockin",
        label: "LOCK-IN",
        sub: "GRIND",
        page: "lock-in.html",
        img: "assets/lockin.jpg",
        vid: "assets/lockin.mp4",
        desc: "Tunnel vision mode. Phone down. Get it done.",
        meta: "Study / deep work packs."
      },
      {
        key: "work",
        label: "WORK",
        sub: "DAY",
        page: "work.html",
        img: "assets/work.jpg",
        vid: "assets/work.mp4",
        desc: "Clean energy. Smooth day. No crash.",
        meta: "Office-ready packs."
      },
      {
        key: "gaming",
        label: "GAMING",
        sub: "NIGHT",
        page: "gaming.html",
        img: "assets/gaming.jpg",
        vid: "assets/gaming.mp4",
        desc: "Locked in. Fast hands. Zero tilt.",
        meta: "Late-night packs."
      },
      {
        key: "mystery",
        label: "MYSTERY",
        sub: "DROP",
        page: "mystery.html",
        img: "assets/mystery.jpg",
        vid: "assets/mystery.mp4",
        desc: "Random pull. Premium chaos (in a good way).",
        meta: "Surprise packs."
      },
      {
        key: "fresh",
        label: "FRESH",
        sub: "CLEAN",
        page: "fresh.html",
        img: "assets/fresh.jpg",
        vid: "assets/fresh.mp4",
        desc: "Light, clean, refreshing. Reset the day.",
        meta: "Fresh & fruity packs."
      }
    ];

    // ========= HELPERS =========
    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
    const normDeg = (d) => ((d % 360) + 360) % 360;
    function waLink(text){
      const msg = encodeURIComponent(text);
      return `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`;
    }

    // ========= DOM =========
    const ringEl = document.getElementById("ring");
    const donutWrap = document.getElementById("donutWrap");
    const donut = document.getElementById("donut");
    const ringCard = document.getElementById("ringCard");
    const resetBtn = document.getElementById("resetBtn");
    const spinBtn = document.getElementById("spinBtn");

    const mediaStage = document.getElementById("mediaStage");
    const prevImg = document.getElementById("prevImg");
    const prevVid = document.getElementById("prevVid");
    const prevTitle = document.getElementById("prevTitle");
    const prevDesc = document.getElementById("prevDesc");
    const prevMeta = document.getElementById("prevMeta");
    const enterBtn = document.getElementById("enterBtn");
    const centerBig = document.getElementById("centerBig");
    const centerSmall = document.getElementById("centerSmall");

    const waTop = document.getElementById("waTop");
    waTop.href = waLink("Hi Snack Packz — I want to place an order.");

    // ========= BUILD RING =========
    const step = 360 / vibes.length;
    const topAngle = 270; // "selector" at the top. Our segments snap to this.
    let activeIndex = 0;

    function buildRing(){
      ringEl.innerHTML = "";
      vibes.forEach((v, i) => {
        const seg = document.createElement("div");
        seg.className = "seg";
        seg.dataset.index = i;
        seg.style.setProperty("--ang", `${i * step}deg`);
        seg.innerHTML = `
          <span class="pill" aria-hidden="true"></span>
          <span class="label">${v.label}</span>
          <span class="sub">${v.sub}</span>
        `;
        ringEl.appendChild(seg);

        // Desktop hover preview
        seg.addEventListener("mouseenter", () => {
          if (window.matchMedia("(hover:hover)").matches) {
            setActive(i, {snap:false, reason:"hover"});
          }
        });
      });

      ringEl.querySelectorAll(".seg").forEach(seg => {
        seg.addEventListener("click", (e) => {
          e.preventDefault();
          const i = Number(seg.dataset.index);
          // Mobile: first tap previews/snaps; second tap enters
          if (window.matchMedia("(hover:none)").matches) {
            if (activeIndex === i && seg.classList.contains("active")) {
              window.location.href = vibes[i].page;
              return;
            }
            setActive(i, {snap:true, reason:"tap"});
            return;
          }
          // Desktop: snap on click
          setActive(i, {snap:true, reason:"click"});
        }, {passive:false});

        seg.addEventListener("dblclick", (e) => {
          e.preventDefault();
          const i = Number(seg.dataset.index);
          window.location.href = vibes[i].page;
        }, {passive:false});
      });
    }

    // ========= PREMIUM PREVIEW (image instantly → fade to video when ready) =========
    let currentVideoToken = 0;
    function loadPreview(v){
      prevTitle.textContent = v.label;
      prevDesc.textContent = v.desc;
      prevMeta.textContent = "Image → Video fade";
      enterBtn.href = v.page;
      centerBig.textContent = v.label.replace("-", " ");
      centerSmall.textContent = v.meta;

      // image shows instantly
      mediaStage.classList.remove("ready");
      prevImg.src = v.img;

      // video fade when ready (avoid flashing old video)
      const token = ++currentVideoToken;
      prevVid.pause();
      prevVid.removeAttribute("src");
      prevVid.load();

      prevVid.src = v.vid;
      // when video can play, fade in
      const onReady = () => {
        if (token !== currentVideoToken) return;
        mediaStage.classList.add("ready");
        prevMeta.textContent = "Video ready";
        try { prevVid.play().catch(()=>{}); } catch(e){}
        cleanup();
      };
      const onError = () => {
        if (token !== currentVideoToken) return;
        // Stay on image if video fails
        mediaStage.classList.remove("ready");
        prevMeta.textContent = "Video unavailable (image only)";
        cleanup();
      };
      const cleanup = () => {
        prevVid.removeEventListener("canplaythrough", onReady);
        prevVid.removeEventListener("loadeddata", onReady);
        prevVid.removeEventListener("error", onError);
      };

      // Some mobiles are picky: loadeddata often triggers sooner than canplaythrough
      prevVid.addEventListener("loadeddata", onReady, {once:true});
      prevVid.addEventListener("canplaythrough", onReady, {once:true});
      prevVid.addEventListener("error", onError, {once:true});
      prevVid.load();
    }

    // ========= ROTATION / SNAP =========
    let rot = 0; // degrees
    let isDragging = false;
    let startAngle = 0;
    let startRot = 0;
    let lastMoveT = 0;
    let lastMoveA = 0;
    let velocity = 0; // deg per ms

    function setRot(deg, {animate=true} = {}){
      rot = deg;
      ringEl.style.setProperty("--rot", `${rot}deg`);
      ringCard.classList.toggle("dragging", !animate);
    }

    function idxToAngle(i){
      return i * step;
    }

    function angleToNearestIndex(currentRot){
      // segment i is at angle (i*step + rot). We want that to be at topAngle.
      // so: i*step + rot ≈ topAngle  =>  i ≈ (topAngle - rot)/step
      const raw = (topAngle - normDeg(currentRot)) / step;
      let i = Math.round(raw);
      i = ((i % vibes.length) + vibes.length) % vibes.length;
      return i;
    }

    function snapToIndex(i, {animate=true} = {}){
      // Solve rot such that (i*step + rot) == topAngle (mod 360)
      const targetRot = topAngle - idxToAngle(i);
      setRot(targetRot, {animate});
    }

    function setActive(i, {snap=true, reason=""} = {}){
      activeIndex = i;

      ringEl.querySelectorAll(".seg").forEach((el) => el.classList.remove("active"));
      const activeEl = ringEl.querySelector(`.seg[data-index="${i}"]`);
      if (activeEl) activeEl.classList.add("active");

      loadPreview(vibes[i]);

      if (snap){
        snapToIndex(i, {animate:true});
      }
    }

    // ========= POINTER (DRAG) =========
    function getPointerAngle(clientX, clientY){
      const r = donut.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top + r.height/2;
      const dx = clientX - cx;
      const dy = clientY - cy;
      // atan2 -> degrees
      return (Math.atan2(dy, dx) * 180 / Math.PI);
    }

    function onPointerDown(e){
      isDragging = true;
      donutWrap.setPointerCapture?.(e.pointerId);
      ringCard.classList.add("dragging");

      startAngle = getPointerAngle(e.clientX, e.clientY);
      startRot = rot;

      lastMoveT = performance.now();
      lastMoveA = startAngle;
      velocity = 0;
    }

    function onPointerMove(e){
      if (!isDragging) return;
      const a = getPointerAngle(e.clientX, e.clientY);
      const delta = a - startAngle;
      setRot(startRot + delta, {animate:false});

      const t = performance.now();
      const dt = t - lastMoveT;
      if (dt > 0){
        // smooth velocity
        const da = a - lastMoveA;
        const v = da / dt;
        velocity = velocity * 0.75 + v * 0.25;
        lastMoveT = t;
        lastMoveA = a;
      }

      // update active highlight live (fast)
      const idx = angleToNearestIndex(rot);
      if (idx !== activeIndex){
        // don't snap while dragging, just update preview
        activeIndex = idx;
        ringEl.querySelectorAll(".seg").forEach((el) => el.classList.remove("active"));
        const activeEl = ringEl.querySelector(`.seg[data-index="${idx}"]`);
        if (activeEl) activeEl.classList.add("active");
        loadPreview(vibes[idx]);
      }
    }

    function onPointerUp(e){
      if (!isDragging) return;
      isDragging = false;
      ringCard.classList.remove("dragging");

      // quick inertial fling then snap immediately (no waiting)
      // we apply a small velocity bump so it feels fast, then snap
      const fling = clamp(velocity * 180, -90, 90); // deg-ish
      setRot(rot + fling, {animate:true});

      // snap after a tiny tick (still feels instant)
      setTimeout(() => {
        const idx = angleToNearestIndex(rot);
        setActive(idx, {snap:true, reason:"dragEnd"});
      }, 60);
    }

    // ========= WHEEL SCROLL =========
    function onWheel(e){
      // allow normal page scroll if user is not over donut area on small screens
      e.preventDefault();
      const delta = e.deltaY || e.wheelDelta || 0;
      // fast scroll => bigger move
      const amt = clamp(delta * 0.18, -24, 24);
      setRot(rot + amt, {animate:false});

      const idx = angleToNearestIndex(rot);
      if (idx !== activeIndex){
        activeIndex = idx;
        ringEl.querySelectorAll(".seg").forEach((el) => el.classList.remove("active"));
        const activeEl = ringEl.querySelector(`.seg[data-index="${idx}"]`);
        if (activeEl) activeEl.classList.add("active");
        loadPreview(vibes[idx]);
      }

      clearTimeout(onWheel._t);
      onWheel._t = setTimeout(() => {
        const idx2 = angleToNearestIndex(rot);
        setActive(idx2, {snap:true, reason:"wheelEnd"});
      }, 110);
    }

    // ========= BUTTONS =========
    resetBtn.addEventListener("click", () => setActive(0, {snap:true, reason:"reset"}));
    spinBtn.addEventListener("click", () => {
      // quick spin feel, then snap
      setRot(rot + 260, {animate:true});
      setTimeout(() => {
        const idx = angleToNearestIndex(rot);
        setActive(idx, {snap:true, reason:"spinEnd"});
      }, 170);
    });

    // ========= ENTER BUTTON (mobile: respects tap twice rule via segment tap) =========
    // On desktop it just enters the currently active vibe
    enterBtn.addEventListener("click", (e) => {
      if (window.matchMedia("(hover:none)").matches){
        // On mobile, treat Enter as enter (obviously)
        return;
      }
    });

    // ========= INIT =========
    buildRing();
    // start with vibe 0 snapped
    snapToIndex(0, {animate:false});
    setActive(0, {snap:false, reason:"init"});

    // events
    donutWrap.addEventListener("pointerdown", onPointerDown, {passive:true});
    window.addEventListener("pointermove", onPointerMove, {passive:true});
    window.addEventListener("pointerup", onPointerUp, {passive:true});
    donutWrap.addEventListener("wheel", onWheel, {passive:false});

    // If user taps outside segments but inside donut on mobile, just toggle "preview mode" feel by snapping to current
    donutWrap.addEventListener("click", (e) => {
      if (!window.matchMedia("(hover:none)").matches) return;
      // ignore if segment was clicked (handled already)
      if (e.target.closest(".seg")) return;
      setActive(activeIndex, {snap:true, reason:"tapDonut"});
    });

    // Keep preview video from blasting audio
    prevVid.muted = true;
    prevVid.playsInline = true;
    prevVid.loop = true;
  </script>
</body>
</html>
