<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Snack Packz</title>
<meta name="theme-color" content="#070818"/>

<style>
  :root{
    --bg0:#050514;
    --bg1:#090826;
    --txt:#F4F6FF;
    --mut:rgba(244,246,255,.72);
    --stroke:rgba(255,255,255,.14);

    --glass:rgba(12,12,30,.46);
    --glass2:rgba(12,12,30,.22);

    --acc:#bfa7ff;
    --acc2:#9be7ff;
    --acc3:#ff5bf0;

    --shadow:0 30px 160px rgba(0,0,0,.72);
    --r:28px;

    --stageW:min(1240px, 94vw);
    --heroH:min(780px, 86vh);

    --globe:min(54vmin, 560px);
    --ringRadius: 210px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    color:var(--txt);
    background:
      radial-gradient(1000px 650px at 50% 5%, rgba(191,167,255,.34), transparent 66%),
      radial-gradient(900px 700px at 70% 20%, rgba(155,231,255,.18), transparent 62%),
      radial-gradient(900px 700px at 20% 30%, rgba(255,91,240,.10), transparent 62%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    overflow:hidden;
  }

  .stars{
    position:fixed; inset:0; pointer-events:none; z-index:0;
    background:
      radial-gradient(1px 1px at 10% 30%, rgba(255,255,255,.55), transparent 60%),
      radial-gradient(1px 1px at 18% 70%, rgba(255,255,255,.35), transparent 60%),
      radial-gradient(1px 1px at 34% 18%, rgba(255,255,255,.44), transparent 60%),
      radial-gradient(1px 1px at 52% 42%, rgba(255,255,255,.30), transparent 60%),
      radial-gradient(1px 1px at 66% 22%, rgba(255,255,255,.38), transparent 60%),
      radial-gradient(1px 1px at 74% 62%, rgba(255,255,255,.36), transparent 60%),
      radial-gradient(1px 1px at 86% 38%, rgba(255,255,255,.36), transparent 60%),
      radial-gradient(1px 1px at 92% 78%, rgba(255,255,255,.30), transparent 60%);
    opacity:.55;
    filter: blur(.2px);
  }

  a{color:inherit; text-decoration:none}
  button{font:inherit}
  button,a{-webkit-tap-highlight-color:transparent}
  .sr{position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden}

  /* NAV */
  .nav{
    position:fixed; top:18px; left:50%; transform:translateX(-50%);
    width:var(--stageW);
    z-index:50;
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 12px;
    border-radius:999px;
    background:rgba(0,0,0,.22);
    border:1px solid rgba(255,255,255,.14);
    backdrop-filter: blur(18px) saturate(140%);
    -webkit-backdrop-filter: blur(18px) saturate(140%);
    box-shadow: 0 16px 90px rgba(0,0,0,.45);
  }
  .brand{display:flex;align-items:center;gap:10px;min-width:0}
  .logo{
    width:34px;height:34px;border-radius:12px;
    background:
      radial-gradient(12px 12px at 30% 30%, rgba(255,255,255,.30), transparent 62%),
      radial-gradient(16px 16px at 70% 70%, rgba(155,231,255,.18), transparent 65%),
      linear-gradient(135deg, rgba(191,167,255,.22), rgba(155,231,255,.14));
    border:1px solid rgba(255,255,255,.14);
    box-shadow: 0 12px 30px rgba(0,0,0,.35);
  }
  .brandTxt{display:flex;flex-direction:column;line-height:1.1}
  .brandTxt b{font-size:14px;letter-spacing:.2px}
  .brandTxt span{font-size:12px;color:rgba(244,246,255,.72)}
  .links{display:flex;gap:18px;color:rgba(244,246,255,.72);font-size:13px}
  .links a{padding:8px 10px;border-radius:999px}
  .links a:hover{background:rgba(255,255,255,.06)}
  .navRight{display:flex;gap:10px;align-items:center}
  .pill{
    display:inline-flex;align-items:center;gap:8px;
    padding:8px 12px;border-radius:999px;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
    color:var(--txt); font-size:13px;
    cursor:pointer;
    user-select:none;
  }
  .dot{
    width:8px;height:8px;border-radius:50%;
    background:linear-gradient(180deg, var(--acc2), var(--acc));
    box-shadow: 0 0 0 4px rgba(155,231,255,.10);
  }

  /* LAYOUT */
  .wrap{
    position:relative;
    z-index:2;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 90px 0 24px;
  }
  .stage{
    width:var(--stageW);
    height:var(--heroH);
    display:grid;
    grid-template-columns: 1.5fr .62fr;
    gap:18px;
    align-items:stretch;
  }

  .hero{
    position:relative;
    border-radius:28px;
    background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.14);
    box-shadow: var(--shadow);
    overflow:hidden;
    backdrop-filter: blur(18px) saturate(140%);
    -webkit-backdrop-filter: blur(18px) saturate(140%);
  }

  .beam{
    position:absolute; inset:-20% -20% 0 -20%;
    background:
      radial-gradient(450px 340px at 50% 22%, rgba(255,255,255,.16), transparent 60%),
      radial-gradient(340px 560px at 50% 30%, rgba(191,167,255,.20), transparent 62%),
      radial-gradient(260px 740px at 50% 42%, rgba(155,231,255,.14), transparent 70%);
    opacity:.95;
    pointer-events:none;
  }
  .streaks{
    position:absolute; inset:0;
    background: repeating-linear-gradient(90deg, rgba(255,255,255,.10) 0, rgba(255,255,255,.10) 1px, transparent 1px, transparent 170px);
    opacity:.14;
    mask-image: radial-gradient(900px 420px at 50% 15%, black, transparent 72%);
    pointer-events:none;
  }

  .content{
    position:relative;
    padding: 44px 44px 28px;
    height:100%;
    display:flex;
    flex-direction:column;
    gap:18px;
    transition: opacity .25s ease, transform .25s ease;
    z-index:5;
  }

  .kicker{
    align-self:center;
    display:inline-flex;
    gap:10px;
    align-items:center;
    padding:8px 14px;
    border-radius:999px;
    background: rgba(0,0,0,.22);
    border:1px solid rgba(255,255,255,.12);
    color:rgba(244,246,255,.72);
    font-size:12px;
  }
  h1{
    margin:0;
    text-align:center;
    font-size: clamp(34px, 4.4vw, 64px);
    letter-spacing: -0.02em;
    line-height:1.02;
  }
  .sub{
    margin:0;
    text-align:center;
    color:rgba(244,246,255,.72);
    max-width: 720px;
    align-self:center;
    font-size: 14px;
    line-height:1.55;
  }
  .ctaRow{
    display:flex;
    justify-content:center;
    gap:10px;
    flex-wrap:wrap;
    margin-top:6px;
  }
  .btn{
    padding:10px 14px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color:var(--txt);
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    gap:10px;
    font-size:13px;
  }
  .btn.primary{
    background: linear-gradient(180deg, rgba(191,167,255,.28), rgba(155,231,255,.14));
    border:1px solid rgba(191,167,255,.32);
    box-shadow: 0 18px 60px rgba(191,167,255,.14);
  }
  .btn:hover{filter: brightness(1.08)}

  .stats{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:14px;
    margin-top:auto;
    padding-top:10px;
  }
  .stat{
    border-radius:18px;
    background: rgba(0,0,0,.22);
    border:1px solid rgba(255,255,255,.12);
    padding:16px 16px 14px;
  }
  .stat strong{font-size:30px;letter-spacing:-.02em;display:block}
  .stat span{color:rgba(244,246,255,.72);font-size:12px;display:block;margin-top:6px;line-height:1.35}

  /* GLOBE / RING */
  .globeZone{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    bottom: 86px;
    width: var(--globe);
    height: var(--globe);
    display:grid;
    place-items:center;
    z-index:4; /* under text, until discover mode */
    transition: transform .25s ease, bottom .25s ease, z-index .2s ease;
  }

  .globeWrap{
    width:100%;
    height:100%;
    position:relative;
    border-radius:50%;
    perspective: 1000px;
    transform-style: preserve-3d;
  }

  canvas#earth{
    width:100%;
    height:100%;
    border-radius:50%;
    display:block;
    box-shadow:
      0 70px 150px rgba(0,0,0,.65),
      inset 0 0 0 1px rgba(255,255,255,.10);
    background: radial-gradient(circle at 35% 30%, rgba(255,255,255,.10), rgba(0,0,0,.55));
  }

  .aurora{
    position:absolute; inset:-6%;
    border-radius:50%;
    pointer-events:none;
    background:
      conic-gradient(from 180deg, transparent, rgba(191,167,255,.18), rgba(155,231,255,.18), transparent 60%, rgba(255,91,240,.12), transparent);
    filter: blur(14px);
    opacity:.85;
    animation: auroraSpin 12s linear infinite;
    transform: translateZ(30px);
  }
  @keyframes auroraSpin{to{transform:translateZ(30px) rotate(360deg)}}

  .scan{
    position:absolute; inset:0;
    border-radius:50%;
    pointer-events:none;
    background:
      repeating-linear-gradient(180deg, rgba(255,255,255,.06) 0, rgba(255,255,255,.06) 1px, transparent 1px, transparent 6px);
    opacity:.10;
    mix-blend-mode: screen;
    mask-image: radial-gradient(circle at 50% 50%, black 55%, transparent 70%);
    animation: scanMove 6s linear infinite;
    transform: translateZ(25px);
  }
  @keyframes scanMove{
    0%{transform:translateZ(25px) translateY(-10%)}
    100%{transform:translateZ(25px) translateY(10%)}
  }

  /* Pack ring */
  .ring{
    position:absolute; inset:0;
    border-radius:50%;
    transform-style: preserve-3d;
    pointer-events:none;
    opacity:0;
    transform: translateZ(80px) scale(.98);
    transition: opacity .22s ease, transform .22s ease;
  }

  .pack{
    position:absolute;
    left:50%; top:50%;
    transform-style: preserve-3d;
    pointer-events:auto;
  }

  .packBtn{
    pointer-events:auto;
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:10px 12px;
    border-radius:999px;
    background: rgba(0,0,0,.36);
    border:1px solid rgba(255,255,255,.14);
    box-shadow: 0 18px 70px rgba(0,0,0,.45);
    cursor:pointer;
    user-select:none;
    -webkit-user-select:none;
    touch-action: manipulation;
    backdrop-filter: blur(14px) saturate(140%);
    -webkit-backdrop-filter: blur(14px) saturate(140%);
    position:relative;
    transition: transform .16s ease, filter .16s ease, box-shadow .16s ease;
    will-change: transform;
  }
  .packBtn:hover{transform: translateY(-2px) scale(1.03)}
  .packCore{
    width:30px; height:30px;
    border-radius:12px;
    background:
      radial-gradient(12px 12px at 30% 30%, rgba(255,255,255,.22), transparent 65%),
      linear-gradient(135deg, rgba(191,167,255,.22), rgba(155,231,255,.12));
    border:1px solid rgba(255,255,255,.14);
    box-shadow: 0 0 0 6px rgba(155,231,255,.08);
    position:relative;
  }
  .packVfx{
    position:absolute; inset:-18px;
    border-radius:999px;
    background:
      radial-gradient(circle at 20% 50%, rgba(155,231,255,.22), transparent 58%),
      radial-gradient(circle at 80% 50%, rgba(191,167,255,.16), transparent 60%);
    filter: blur(10px);
    opacity:0;
    transition: opacity .16s ease;
    pointer-events:none;
  }
  .packBtn:hover .packVfx{opacity:.95}
  .packName{
    font-weight:800;
    letter-spacing:.12em;
    font-size:12px;
  }
  .packTag{
    margin-left:6px;
    font-size:11px;
    color:rgba(244,246,255,.62);
    letter-spacing:.02em;
  }

  .pack.selected .packBtn{
    border-color: rgba(155,231,255,.40);
    background: rgba(12,12,30,.52);
    box-shadow:
      0 26px 120px rgba(155,231,255,.14),
      0 18px 90px rgba(0,0,0,.55);
  }

  /* Discover mode (THIS is the “hover centrepiece, text fades, options appear”) */
  .hero.discover .content{
    opacity:.08;
    transform: translateY(-6px);
    pointer-events:none;
  }
  .hero.discover .globeZone{
    z-index:8; /* above the hero copy */
    transform: translateX(-50%) scale(1.05);
    bottom: 78px;
  }
  .hero.discover .ring{
    opacity:1;
    transform: translateZ(90px) scale(1);
    pointer-events:auto;
  }

  .hint{
    position:absolute;
    left:50%;
    top:24px;
    transform:translateX(-50%);
    padding:10px 12px;
    border-radius:999px;
    background: rgba(0,0,0,.30);
    border:1px solid rgba(255,255,255,.12);
    color:rgba(244,246,255,.72);
    font-size:12px;
    backdrop-filter: blur(14px);
    z-index:9;
    transition: opacity .2s ease;
  }
  .hero.discover .hint{opacity:.0; pointer-events:none}

  /* Right preview panel */
  .panel{
    position:relative;
    border-radius:24px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.35);
    overflow:hidden;
    box-shadow: 0 24px 120px rgba(0,0,0,.60);
    backdrop-filter: blur(18px) saturate(140%);
    -webkit-backdrop-filter: blur(18px) saturate(140%);
    display:flex;
    flex-direction:column;
  }
  .panelHead{
    padding:18px 18px 12px;
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
  }
  .panelTitle{display:flex;flex-direction:column;gap:6px;min-width:0}
  .panelTitle b{font-size:16px;letter-spacing:.10em}
  .panelTitle span{font-size:12px;color:rgba(244,246,255,.72);line-height:1.35}

  .enterBtn{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    cursor:pointer;
    white-space:nowrap;
  }
  .enterBtn strong{font-size:12px}
  .enterBtn:hover{filter:brightness(1.07)}

  .media{
    position:relative;
    flex:1;
    min-height: 360px;
    background:#000;
    overflow:hidden;
    border-radius: 18px;
    margin: 0 12px 12px;
    border:1px solid rgba(255,255,255,.10);
  }
  .media img, .media video{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit:cover;
    transform: scale(1.02);
  }
  .media img{opacity:1;transition:opacity .22s ease}
  .media video{opacity:0;transition:opacity .28s ease}

  .badge{
    position:absolute;
    left:12px; bottom:12px;
    padding:8px 10px;
    border-radius:14px;
    background: rgba(0,0,0,.48);
    border:1px solid rgba(255,255,255,.14);
    font-size:12px;
    color:rgba(244,246,255,.72);
    display:flex;
    gap:8px;
    align-items:center;
    backdrop-filter: blur(12px);
  }
  .badge .tinyDot{
    width:7px; height:7px;
    border-radius:50%;
    background: linear-gradient(180deg, var(--acc2), var(--acc));
    box-shadow: 0 0 0 4px rgba(155,231,255,.10);
  }

  .panelFoot{
    padding: 0 18px 16px;
    color:rgba(244,246,255,.62);
    font-size:12px;
    line-height:1.45;
  }

  /* Mobile */
  @media (max-width: 980px){
    body{overflow:auto}
    .stage{height:auto;grid-template-columns:1fr}
    .hero{min-height: 760px}
    .panel{min-height: 520px}
    .globeZone{
      position:relative;
      left:auto; transform:none;
      bottom:auto;
      margin: 6px auto 0;
    }
    .hero.discover .globeZone{
      transform: scale(1.03);
      bottom:auto;
    }
    .stats{grid-template-columns:1fr}
    .links{display:none}
    :root{ --ringRadius: 185px; }
  }

  @media (max-width: 420px){
    .content{padding: 36px 18px 18px}
    :root{ --ringRadius: 165px; }
  }
</style>
</head>

<body>
  <div class="stars"></div>

  <header class="nav" aria-label="Top navigation">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="brandTxt">
        <b>Snack Packz</b>
        <span>Spin the globe. Pick your pack.</span>
      </div>
    </div>

    <nav class="links" aria-label="Site">
      <a href="#packs">Packs</a>
      <a href="#how">How it works</a>
      <a href="#order">Order</a>
    </nav>

    <div class="navRight">
      <div class="pill" title="Controls: drag + scroll + snap">
        <span class="dot"></span>
        Drag • Scroll • Snap
      </div>
      <a class="pill" href="https://wa.me/447483849357" target="_blank" rel="noopener">
        <span class="dot"></span>
        WhatsApp
      </a>
    </div>
  </header>

  <main class="wrap">
    <section class="stage">
      <section class="hero" id="hero">
        <div class="beam"></div>
        <div class="streaks"></div>

        <div class="content" id="content">
          <div class="kicker">
            <span style="display:inline-flex;align-items:center;gap:10px">
              <span class="dot"></span>
              Neon globe • packs appear on hover/tap
            </span>
          </div>

          <h1>Snack Packs — but <span style="color:rgba(191,167,255,.95)">rewarding</span>.</h1>

          <p class="sub" id="how">
            Hover the globe (or tap on mobile) to reveal the packs. Drag to rotate, scroll to flick. Tap a pack to preview (image → video).
          </p>

          <div class="ctaRow" id="order">
            <button class="btn primary" id="btnDiscover">Discover packs</button>
            <a class="btn" href="https://wa.me/447483849357" target="_blank" rel="noopener">Order on WhatsApp</a>
          </div>

          <div class="stats">
            <div class="stat">
              <strong>500+</strong>
              <span>Packs delivered. Clean builds, no mess.</span>
            </div>
            <div class="stat">
              <strong>240+</strong>
              <span>People found their go-to vibe.</span>
            </div>
            <div class="stat">
              <strong>98%</strong>
              <span>Repeat order rate. Consistency hits.</span>
            </div>
          </div>
        </div>

        <div class="globeZone" id="globeZone" aria-label="Interactive globe">
          <div class="globeWrap" id="globeWrap">
            <div class="hint" id="hint">Hover / tap the globe to reveal packs</div>
            <canvas id="earth" width="900" height="900" aria-label="Neon globe"></canvas>
            <div class="aurora"></div>
            <div class="scan"></div>

            <div class="ring" id="ring" aria-label="Pack ring"></div>
          </div>
        </div>
      </section>

      <aside class="panel" aria-label="Preview panel">
        <div class="panelHead">
          <div class="panelTitle">
            <b id="pTitle">GYM</b>
            <span id="pDesc">High focus. Clean fuel. No distractions.</span>
          </div>
          <button class="enterBtn" id="enterBtn" aria-label="Enter pack page">
            <span class="dot"></span>
            <strong>Enter</strong>
          </button>
        </div>

        <div class="media" id="media">
          <img id="pImg" alt="Preview image" src="./assets/gym.jpg">
          <video id="pVid" muted playsinline preload="metadata"></video>
          <div class="badge">
            <span class="tinyDot"></span>
            <span id="badgeTxt">Tap a pack to preview</span>
          </div>
        </div>

        <div class="panelFoot">
          Mobile: tap the globe to reveal. Tap a pack once to preview. Tap it again (or hit Enter) to open.
        </div>
      </aside>
    </section>
  </main>

<script>
(() => {
  // ================= DATA =================
  const packs = [
    { key:'gym',     name:'GYM',     tag:'FOCUS', desc:'High focus. Clean fuel. No distractions.', img:'./assets/gym.jpg',     vid:'./assets/gym.mp4',     href:'./gym.html' },
    { key:'lockin',  name:'LOCK-IN', tag:'GRIND', desc:'Tunnel vision mode. Phone down. Get it done.', img:'./assets/lockin.jpg',  vid:'./assets/lockin.mp4',  href:'./lock-in.html' },
    { key:'work',    name:'WORK',    tag:'DAY',   desc:'Clean energy. Smooth day. No crash.', img:'./assets/work.jpg',    vid:'./assets/work.mp4',    href:'./work.html' },
    { key:'gaming',  name:'GAMING',  tag:'NIGHT', desc:'Locked in. Fast hands. Zero tilt.', img:'./assets/gaming.jpg',  vid:'./assets/gaming.mp4',  href:'./gaming.html' },
    { key:'mystery', name:'MYSTERY', tag:'DROP',  desc:'Random hit. New flavour. New mood.', img:'./assets/mystery.jpg', vid:'./assets/mystery.mp4', href:'./mystery.html' },
    { key:'fresh',   name:'FRESH',   tag:'CLEAN', desc:'Light, clean, refreshing. Reset the day.', img:'./assets/fresh.jpg',   vid:'./assets/fresh.mp4',   href:'./fresh.html' },
  ];

  // ================= ELEMENTS =================
  const hero = document.getElementById('hero');
  const globeZone = document.getElementById('globeZone');
  const globeWrap = document.getElementById('globeWrap');
  const ring = document.getElementById('ring');
  const btnDiscover = document.getElementById('btnDiscover');

  const earth = document.getElementById('earth');
  const ctx = earth.getContext('2d');

  const pTitle = document.getElementById('pTitle');
  const pDesc  = document.getElementById('pDesc');
  const pImg   = document.getElementById('pImg');
  const pVid   = document.getElementById('pVid');
  const badgeTxt = document.getElementById('badgeTxt');
  const enterBtn = document.getElementById('enterBtn');

  // ================= STATE =================
  let discovered = false;

  // ring rotation (radians)
  let angle = 0;
  let vel = 0;
  let dragging = false;
  let lastX = 0;
  let lastT = 0;

  let selectedKey = packs[0].key;

  // mobile double-tap-to-enter behaviour for packs
  let lastTapped = null;
  let lastTapTime = 0;

  // ================= UTIL =================
  const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
  const lerp = (a,b,t)=>a+(b-a)*t;

  function normAngle(a){
    a = a % (Math.PI*2);
    if(a < 0) a += Math.PI*2;
    return a;
  }

  // ================= DISCOVER MODE =================
  function setDiscover(on){
    discovered = on;
    hero.classList.toggle('discover', on);
  }

  // Desktop: hover globe to discover (works like reference)
  globeWrap.addEventListener('mouseenter', () => setDiscover(true));
  hero.addEventListener('mouseleave', () => {
    // don’t instantly hide if you’re actively dragging
    if(!dragging) setDiscover(false);
  });

  // Mobile: tap globe to discover
  globeWrap.addEventListener('click', () => {
    const isMobile = matchMedia('(max-width: 980px)').matches;
    if(isMobile) setDiscover(true);
  });

  btnDiscover.addEventListener('click', () => setDiscover(true));

  // ================= EARTH RENDER (stylised premium) =================
  function resize(){
    const rect = globeWrap.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    const size = Math.floor(Math.min(960, Math.max(720, rect.width * dpr)));
    earth.width = earth.height = size;
  }

  function drawEarth(t){
    const w = earth.width, h = earth.height;
    const cx = w/2, cy = h/2;
    const R = w*0.42;

    ctx.clearRect(0,0,w,h);

    // Base shading
    const grad = ctx.createRadialGradient(cx - R*0.35, cy - R*0.35, R*0.2, cx, cy, R);
    grad.addColorStop(0, 'rgba(255,255,255,.14)');
    grad.addColorStop(0.35,'rgba(155,231,255,.12)');
    grad.addColorStop(0.62,'rgba(191,167,255,.08)');
    grad.addColorStop(1, 'rgba(0,0,0,.78)');

    ctx.beginPath();
    ctx.arc(cx,cy,R,0,Math.PI*2);
    ctx.closePath();
    ctx.fillStyle = grad;
    ctx.fill();

    // Mask to sphere
    ctx.save();
    ctx.beginPath();
    ctx.arc(cx,cy,R,0,Math.PI*2);
    ctx.clip();

    // Subtle “neon geo” bands (procedural – fast + alive)
    const time = t*0.001;
    ctx.globalCompositeOperation = 'screen';

    for(let i=0;i<10;i++){
      const y = (i/10)*h;
      const a = 0.08 + 0.04*Math.sin(time*0.9 + i);
      ctx.strokeStyle = `rgba(155,231,255,${a})`;
      ctx.lineWidth = 2;

      ctx.beginPath();
      for(let x=0;x<=w;x+=10){
        const yy = y + Math.sin(time*1.2 + x*0.02 + i)*6;
        ctx.lineTo(x, yy);
      }
      ctx.stroke();
    }

    // Grid arcs
    ctx.lineWidth = 1.5;
    ctx.strokeStyle = 'rgba(191,167,255,.12)';
    for(let i=0;i<7;i++){
      const rr = R*(0.25 + i*0.11);
      ctx.beginPath();
      ctx.arc(cx,cy, rr, 0, Math.PI*2);
      ctx.stroke();
    }

    // Edge vignette
    ctx.globalCompositeOperation = 'multiply';
    const vign = ctx.createRadialGradient(cx + R*0.35, cy + R*0.10, R*0.1, cx, cy, R);
    vign.addColorStop(0,'rgba(0,0,0,0)');
    vign.addColorStop(1,'rgba(0,0,0,.40)');
    ctx.fillStyle = vign;
    ctx.fillRect(0,0,w,h);

    ctx.restore();

    // Sphere edge highlight
    ctx.globalCompositeOperation = 'screen';
    ctx.lineWidth = 2;
    ctx.strokeStyle = 'rgba(255,255,255,.10)';
    ctx.beginPath();
    ctx.arc(cx,cy,R,0,Math.PI*2);
    ctx.stroke();
    ctx.globalCompositeOperation = 'source-over';
  }

  // ================= PREVIEW (image -> video) =================
  let videoToken = 0;
  function setPreview(pack){
    pTitle.textContent = pack.name;
    pDesc.textContent = pack.desc;

    // image immediately
    pImg.style.opacity = '1';
    pImg.src = pack.img;

    // video fades in only when ready
    const token = ++videoToken;
    pVid.style.opacity = '0';
    pVid.pause();
    pVid.removeAttribute('src');
    pVid.load();

    pVid.src = pack.vid;
    pVid.currentTime = 0;

    badgeTxt.textContent = 'Loading video…';

    const onReady = async () => {
      if(token !== videoToken) return;
      try{ await pVid.play(); }catch(e){}
      if(token !== videoToken) return;
      requestAnimationFrame(() => {
        pVid.style.opacity = '1';
        pImg.style.opacity = '0';
      });
      badgeTxt.textContent = 'Video ready';
    };

    pVid.addEventListener('canplay', onReady, {once:true});
  }

  function setSelected(key, updatePreview=true){
    selectedKey = key;
    for(const el of ring.querySelectorAll('.pack')){
      el.classList.toggle('selected', el.dataset.key === key);
    }
    const pack = packs.find(p=>p.key===key) || packs[0];
    enterBtn.onclick = () => window.location.href = pack.href;
    if(updatePreview) setPreview(pack);
  }

  // ================= BUILD RING =================
  function buildRing(){
    ring.innerHTML = '';
    const N = packs.length;

    packs.forEach((p, i) => {
      const wrap = document.createElement('div');
      wrap.className = 'pack';
      wrap.dataset.key = p.key;

      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'packBtn';
      btn.innerHTML = `
        <div class="packVfx"></div>
        <div class="packCore"></div>
        <div><span class="packName">${p.name}</span><span class="packTag">${p.tag}</span></div>
      `;

      btn.addEventListener('click', (e) => {
        e.preventDefault();
        setDiscover(true);

        // snap ring so clicked pack goes to the “top/front”
        const target = i * (Math.PI*2/N);
        // we want that item at angle = 0 (top/front reference)
        const desired = -target;
        let delta = desired - angle;
        delta = Math.atan2(Math.sin(delta), Math.cos(delta)); // shortest
        angle += delta;
        vel = 0;

        setSelected(p.key, true);

        const isMobile = matchMedia('(max-width: 980px)').matches;
        const now = performance.now();
        if(isMobile){
          if(lastTapped === p.key && (now - lastTapTime) < 1400){
            window.location.href = p.href;
            return;
          }
          lastTapped = p.key;
          lastTapTime = now;
          badgeTxt.textContent = 'Tap again to enter';
        }else{
          badgeTxt.textContent = 'Selected — hit Enter';
        }
      });

      wrap.appendChild(btn);
      ring.appendChild(wrap);
    });

    setSelected(selectedKey, false);
  }

  // 3D placement + depth
  function layoutRing(){
    const N = packs.length;
    const radius = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ringRadius')) || 210;

    // “front” is at theta=0 (top)
    for(let i=0;i<N;i++){
      const p = packs[i];
      const el = ring.querySelector(`.pack[data-key="${p.key}"]`);
      if(!el) continue;

      const theta = angle + i*(Math.PI*2/N);

      // Position around circle in X/Y
      const x = Math.sin(theta) * radius;
      const y = -Math.cos(theta) * radius;

      // Depth based on cos: front items (theta~0) appear closer
      const depth = (Math.cos(theta) + 1) / 2; // 0..1
      const z = lerp(-120, 140, depth);
      const s = lerp(0.82, 1.18, depth);

      // Slight lighting feel
      const dim = lerp(0.78, 1.08, depth);

      el.style.transform = `
        translate(-50%, -50%)
        translate3d(${x}px, ${y}px, ${z}px)
        scale(${s})
      `;
      el.style.zIndex = Math.floor(depth * 1000);
      el.style.filter = `brightness(${dim})`;
      el.style.opacity = discovered ? '1' : '0';
    }

    // Auto-select nearest to top/front when it settles
    if(!dragging && Math.abs(vel) < 0.00045 && discovered){
      // nearest to theta ≈ 0 means item whose (angle + iStep) is closest to 0
      let bestI = 0;
      let best = 1e9;
      for(let i=0;i<N;i++){
        let t = angle + i*(Math.PI*2/N);
        t = Math.atan2(Math.sin(t), Math.cos(t));
        const d = Math.abs(t);
        if(d < best){ best = d; bestI = i; }
      }
      const bestKey = packs[bestI].key;
      if(bestKey !== selectedKey){
        setSelected(bestKey, true);
      }
    }
  }

  // ================= DRAG / WHEEL =================
  function pointerX(e){ return e.touches ? e.touches[0].clientX : e.clientX; }

  function onDown(e){
    setDiscover(true);
    dragging = true;
    lastX = pointerX(e);
    lastT = performance.now();
    vel = 0;
  }

  function onMove(e){
    if(!dragging) return;
    const x = pointerX(e);
    const now = performance.now();
    const dx = x - lastX;
    const dt = Math.max(10, now - lastT);

    angle += dx * 0.0062;      // fast
    vel = (dx / dt) * 0.0125;  // inertia proxy

    lastX = x;
    lastT = now;
  }

  function onUp(){
    dragging = false;
  }

  function onWheel(e){
    setDiscover(true);
    e.preventDefault();
    const d = clamp(e.deltaY, -80, 80);
    vel += d * 0.00012;
  }

  globeWrap.addEventListener('mousedown', onDown);
  window.addEventListener('mousemove', onMove);
  window.addEventListener('mouseup', onUp);

  globeWrap.addEventListener('touchstart', onDown, {passive:true});
  window.addEventListener('touchmove', onMove, {passive:true});
  window.addEventListener('touchend', onUp);

  globeWrap.addEventListener('wheel', onWheel, {passive:false});

  // ================= KEYBOARD =================
  window.addEventListener('keydown', (e) => {
    if(e.key === 'Enter'){
      const pack = packs.find(p=>p.key===selectedKey) || packs[0];
      window.location.href = pack.href;
    }
  });

  // ================= LOOP =================
  function tick(t){
    if(!dragging){
      angle += vel;
      vel *= 0.965;
      if(Math.abs(vel) < 0.00018) vel = 0;
    }

    drawEarth(t);
    layoutRing();

    requestAnimationFrame(tick);
  }

  // ================= INIT =================
  function init(){
    resize();
    buildRing();
    setPreview(packs[0]);

    // Desktop: auto discover if user moves near globe (feels premium)
    let armed = false;
    window.addEventListener('mousemove', () => {
      if(armed) return;
      armed = true;
      setTimeout(()=>{ armed = false; }, 1200);
    });

    requestAnimationFrame(tick);
  }

  window.addEventListener('resize', resize);
  init();
})();
</script>
</body>
</html>
