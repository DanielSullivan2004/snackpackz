<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Snack Packz — Spin Select</title>
  <meta name="theme-color" content="#070812"/>

  <style>
    :root{
      --txt:#EEF3FF;
      --mut:rgba(238,243,255,.70);
      --line:rgba(255,255,255,.10);
      --glass:rgba(10,14,26,.55);
      --shadow:0 20px 80px rgba(0,0,0,.60);
      --r:22px;

      --accent:#9BE7FF;
      --accent2:#B7A8FF;
      --hot:#FF6A3D;

      --hudW:min(42vw, 560px);
      --wheelSize:min(56vmin, 520px);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:#050612;
      overflow:hidden;
    }
    a{ color:inherit; text-decoration:none; }
    button{ font:inherit; }

    /* ===== HERO BACKGROUND (REALISTIC) ===== */
    .hero{
      position:fixed;
      inset:0;
      z-index:0;
      background:
        radial-gradient(1200px 700px at 18% 12%, rgba(155,231,255,.10), transparent 62%),
        radial-gradient(1200px 700px at 82% 25%, rgba(183,168,255,.08), transparent 62%),
        linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.65)),
        url("assets/hero-car.webp");
      background-size: cover;
      background-position: center;
      filter: contrast(1.05) saturate(1.04);
      transform: translateZ(0);
    }
    .hero:after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(0,0,0,.12), transparent 60%),
        radial-gradient(900px 700px at 70% 30%, rgba(0,0,0,.28), transparent 65%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.72));
      pointer-events:none;
    }

    /* ===== TOP BAR ===== */
    .topbar{
      position:fixed; left:0; right:0; top:0;
      z-index:50;
      padding: 14px 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:14px;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(0,0,0,.60), rgba(0,0,0,.12));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .brand{ display:flex; gap:12px; align-items:center; min-width:0; }
    .logo{
      width:40px;height:40px;border-radius:14px;
      background:
        radial-gradient(14px 14px at 30% 30%, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(18px 18px at 70% 65%, rgba(155,231,255,.22), transparent 65%),
        linear-gradient(135deg, rgba(155,231,255,.25), rgba(183,168,255,.20));
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
      flex:0 0 auto;
    }
    .brandText h1{ margin:0; font-size:15px; font-weight:950; letter-spacing:.5px; }
    .brandText p{ margin:4px 0 0; font-size:12px; color:rgba(238,243,255,.70); }

    .chip,.btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color: rgba(238,243,255,.92);
      border-radius: 999px;
      padding: 9px 12px;
      font-size: 12px;
      letter-spacing:.2px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      cursor:pointer;
    }
    .chip:hover,.btn:hover{ transform: translateY(-1px); background: rgba(0,0,0,.28); border-color: rgba(255,255,255,.20); }
    .chip:active,.btn:active{ transform: translateY(0px) scale(.99); }
    .dot{
      width:7px;height:7px;border-radius:50%;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 4px rgba(155,231,255,.10);
    }
    .right{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center; }

    /* ===== LAYOUT ===== */
    .scene{
      position:fixed; inset:0;
      padding-top:72px;
      z-index:10;
      display:grid;
      grid-template-columns: 1fr var(--hudW);
      gap: clamp(12px, 2.2vw, 22px);
      align-items:stretch;
    }
    @media (max-width: 980px){
      body{ overflow:auto; }
      .scene{
        position:relative;
        padding-top:76px;
        grid-template-columns: 1fr;
      }
    }

    /* ===== LEFT PANEL ===== */
    .leftPane{
      padding: clamp(10px, 2vw, 18px);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .card{
      width:min(980px, 100%);
      border-radius: var(--r);
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
      position:relative;
    }
    .head{
      padding: 16px;
      display:flex;
      justify-content:space-between;
      gap:14px;
      border-bottom:1px solid rgba(255,255,255,.06);
      position:relative;
      z-index:2;
    }
    .head h2{ margin:0; font-size:16px; font-weight:950; letter-spacing:.5px; }
    .head p{ margin:6px 0 0; font-size:12.5px; color:rgba(238,243,255,.70); }
    .miniBtns{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }

    .stageRow{
      display:grid;
      grid-template-columns: 1fr 300px;
      gap:14px;
      padding: 14px;
      position:relative;
      z-index:2;
    }
    @media (max-width: 920px){ .stageRow{ grid-template-columns: 1fr; } }

    .carStage{
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      overflow:hidden;
      box-shadow: 0 20px 70px rgba(0,0,0,.45);
      min-height: max(520px, calc(var(--wheelSize) + 190px));
      position:relative;
    }
    .carStage:before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(1000px 520px at 15% 15%, rgba(155,231,255,.08), transparent 60%),
        radial-gradient(900px 600px at 70% 30%, rgba(183,168,255,.06), transparent 65%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.55));
      pointer-events:none;
      z-index:1;
    }

    /* Wheel overlay anchored to "front wheel" location */
    .wheelZone{
      position:absolute;
      left: clamp(26px, 3vw, 46px);
      bottom: clamp(24px, 3vw, 44px);
      width: var(--wheelSize);
      height: var(--wheelSize);
      z-index:5;
      display:grid;
      place-items:center;
      touch-action:none;
      user-select:none;
    }

    .wheelImg{
      width:100%;
      height:100%;
      object-fit:contain;
      transform: rotate(var(--rot, 0deg));
      will-change: transform;
      filter: drop-shadow(0 35px 90px rgba(0,0,0,.80));
      pointer-events:none;
      user-select:none;
    }

    /* heat / sparks are subtle and premium */
    .heatRing{
      position:absolute; inset:-10%;
      border-radius:50%;
      opacity:0;
      transition: opacity .14s ease;
      background:
        radial-gradient(circle at 55% 50%, rgba(255,106,61,.35), transparent 60%),
        radial-gradient(circle at 45% 40%, rgba(255,210,122,.20), transparent 55%),
        radial-gradient(circle at 50% 50%, rgba(155,231,255,.12), transparent 65%);
      filter: blur(10px);
      mix-blend-mode: screen;
      pointer-events:none;
    }
    .heatRing.on{ opacity:1; }

    .sparkRing{
      position:absolute; inset:-18%;
      border-radius:50%;
      opacity:0;
      transition: opacity .14s ease;
      pointer-events:none;
      mix-blend-mode: screen;
      background:
        repeating-conic-gradient(from 0deg,
          rgba(255,106,61,0) 0deg 7deg,
          rgba(255,106,61,.18) 7deg 7.6deg
        );
      -webkit-mask: radial-gradient(circle at 50% 50%, transparent 48%, #000 54%, #000 82%, transparent 88%);
              mask: radial-gradient(circle at 50% 50%, transparent 48%, #000 54%, #000 82%, transparent 88%);
    }
    .sparkRing.on{ opacity:.75; }

    /* Markers around wheel */
    .markers{
      position:absolute;
      inset:0;
      z-index:7;
      pointer-events:auto;
    }
    .marker{
      position:absolute;
      left:50%; top:50%;
      height:34px;
      transform-origin: 0% 50%;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.26);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      display:flex;
      align-items:center;
      gap:10px;
      padding: 0 12px;
      cursor:pointer;
      box-shadow: 0 16px 55px rgba(0,0,0,.55);
      transition: border-color .12s ease, background .12s ease, box-shadow .12s ease;
      white-space:nowrap;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    .marker:hover{ border-color: rgba(255,255,255,.22); background: rgba(0,0,0,.30); }
    .marker.active{ border-color: rgba(155,231,255,.36); box-shadow: 0 18px 70px rgba(0,0,0,.70); }

    .mDot{
      width:10px;height:10px;border-radius:50%;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 6px rgba(155,231,255,.10);
      flex:0 0 auto;
    }
    .mTxt{ font-weight:950; font-size:12px; letter-spacing:.55px; text-transform:uppercase; }
    .mSub{ margin-left:auto; font-size:11px; color:rgba(238,243,255,.66); letter-spacing:.2px; text-transform:uppercase; }

    /* ===== SPEED HUD (CODED, CLEAN) ===== */
    .speedPanel{
      border-radius:20px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 20px 70px rgba(0,0,0,.45);
      padding:14px 12px 12px;
      overflow:hidden;
      position:relative;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .speedHead{ display:flex; justify-content:space-between; align-items:baseline; gap:10px; }
    .speedHead h3{ margin:0; font-size:12px; font-weight:950; letter-spacing:.35px; color:rgba(238,243,255,.85); }
    .rank{ font-size:11px; color:rgba(238,243,255,.65); font-weight:800; }

    canvas#speedCanvas{
      width:100%;
      aspect-ratio: 16/10;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      box-shadow: 0 16px 55px rgba(0,0,0,.40);
      display:block;
    }
    .digits{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .digitBox{
      flex:1;
      min-width: 120px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding: 10px 12px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .digitBox .k{ font-size:11px; color:rgba(238,243,255,.65); }
    .digitBox .v{ margin-top:6px; font-size:20px; font-weight:950; letter-spacing:.6px; line-height:1; }
    .digitBox .u{ margin-top:6px; font-size:11px; color:rgba(238,243,255,.60); }
    .panelBtns{ display:flex; gap:10px; flex-wrap:wrap; }
    .panelBtns .btn{ flex:1; justify-content:center; border-radius:14px; padding:10px 12px; font-weight:950; }

    .foot{
      padding: 10px 16px 14px;
      border-top:1px solid rgba(255,255,255,.06);
      font-size:11px;
      color:rgba(238,243,255,.60);
      position:relative;
      z-index:2;
    }

    /* ===== RIGHT PREVIEW ===== */
    .hud{
      position:relative;
      border-left:1px solid rgba(255,255,255,.06);
      padding: clamp(10px, 2vw, 16px);
      display:flex;
      align-items:stretch;
      z-index:10;
    }
    @media (max-width: 980px){ .hud{ border-left:none; } }

    .hudCard{
      width:100%;
      border-radius: var(--r);
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      position:relative;
      min-height: 420px;
    }
    @media (max-width: 980px){ .hudCard{ min-height: 360px; } }

    .hudMedia{ position:absolute; inset:0; z-index:2; }
    .hudMedia img, .hudMedia video{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit: cover;
      transform: scale(1.02);
      filter: contrast(1.06) saturate(1.03);
    }
    .hudMedia img{ opacity:1; transition: opacity 220ms ease; }
    .hudMedia video{ opacity:0; transition: opacity 320ms ease; }
    .hudMedia.ready video{ opacity:1; }
    .hudMedia.ready img{ opacity:0; }

    .hudShade{
      position:absolute; inset:0; z-index:3;
      background:
        radial-gradient(700px 380px at 20% 10%, rgba(0,0,0,.12), transparent 60%),
        radial-gradient(800px 520px at 70% 35%, rgba(0,0,0,.26), transparent 65%),
        linear-gradient(180deg, rgba(0,0,0,.08), rgba(0,0,0,.70));
      pointer-events:none;
    }
    .hudTop{
      position:relative; z-index:5;
      padding:16px 16px 0;
      display:flex; justify-content:space-between; gap:12px; align-items:flex-start;
    }
    .hudTitle h3{ margin:0; font-size:18px; font-weight:950; letter-spacing:.5px; text-shadow: 0 18px 50px rgba(0,0,0,.65); }
    .hudTitle p{ margin:6px 0 0; font-size:12.5px; color:rgba(238,243,255,.78); line-height:1.35; text-shadow: 0 18px 50px rgba(0,0,0,.65); max-width:46ch; }
    .enter{
      border-radius: 16px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.26);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      font-size: 12px;
      font-weight: 950;
      letter-spacing:.25px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      white-space:nowrap;
    }
    .spark{
      width:18px;height:18px;border-radius:10px;
      background: linear-gradient(180deg, rgba(155,231,255,.90), rgba(183,168,255,.82));
      box-shadow: 0 0 0 6px rgba(155,231,255,.10);
      border:1px solid rgba(255,255,255,.12);
    }

    .hudBottom{
      position:absolute; left:0; right:0; bottom:0;
      z-index:6;
      padding:14px 16px 16px;
      display:flex; justify-content:space-between; gap:12px; align-items:flex-end;
    }
    .hudStat{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      border-radius: 16px;
      padding: 10px 12px;
      max-width: 62%;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .hudStat .k{ font-size:11px; color:rgba(238,243,255,.70); }
    .hudStat .v{ margin-top:5px; font-size:12.5px; font-weight:950; }
    .hudTip{
      text-align:right;
      font-size:11px;
      color:rgba(238,243,255,.70);
      line-height:1.25;
      text-shadow: 0 18px 50px rgba(0,0,0,.65);
    }
  </style>
</head>
<body>

  <div class="hero" aria-hidden="true"></div>

  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div class="brandText">
        <h1>Snack Packz</h1>
        <p>Spin the wheel. Pick your vibe. Order fast.</p>
      </div>
    </div>
    <div class="right">
      <div class="chip"><span class="dot"></span> Drag • Scroll • Snap</div>
      <a class="chip" id="waTop" href="#" rel="noopener">WhatsApp Order</a>
    </div>
  </div>

  <div class="scene">
    <!-- LEFT -->
    <div class="leftPane">
      <div class="card">
        <div class="head">
          <div>
            <h2>Spin Select</h2>
            <p>Spin the front wheel. Speedometer reacts live. Preview loads clean (image → video).</p>
          </div>
          <div class="miniBtns">
            <button class="btn" id="resetBtn" type="button">Reset</button>
            <button class="btn" id="boostBtn" type="button">Boost</button>
          </div>
        </div>

        <div class="stageRow">
          <div class="carStage" id="carStage">
            <div class="wheelZone" id="wheelZone">
              <div class="heatRing" id="heatRing"></div>
              <div class="sparkRing" id="sparkRing"></div>
              <img class="wheelImg" id="wheelImg" src="assets/front-wheel.webp" alt="Wheel"/>
              <div class="markers" id="markers" aria-label="Vibes"></div>
            </div>
          </div>

          <div class="speedPanel">
            <div class="speedHead">
              <h3>SPIN SPEED</h3>
              <div class="rank" id="rankTxt">Rank: Warm</div>
            </div>

            <canvas id="speedCanvas" width="800" height="500"></canvas>

            <div class="digits">
              <div class="digitBox">
                <div class="k">Speed</div>
                <div class="v" id="spdVal">0</div>
                <div class="u">SPIN / SEC</div>
              </div>
              <div class="digitBox">
                <div class="k">Peak</div>
                <div class="v" id="peakVal">0</div>
                <div class="u">TOP HIT</div>
              </div>
            </div>

            <div class="panelBtns">
              <button class="btn" id="brakeBtn" type="button">Brake</button>
              <button class="btn" id="autoBtn" type="button">Auto</button>
            </div>
          </div>
        </div>

        <div class="foot">Tip: click/tap a vibe label to snap instantly. Drag the wheel to throw it. Scroll to flick.</div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="hud">
      <div class="hudCard">
        <div class="hudMedia" id="hudMedia" aria-hidden="true">
          <img id="hudImg" src="assets/gym.jpg" alt=""/>
          <video id="hudVid" muted playsinline loop preload="metadata"></video>
        </div>
        <div class="hudShade" aria-hidden="true"></div>

        <div class="hudTop">
          <div class="hudTitle">
            <h3 id="hudTitle">GYM</h3>
            <p id="hudDesc">High focus. Clean fuel. No distractions.</p>
          </div>
          <a class="enter" id="enterBtn" href="gym.html">
            <span class="spark" aria-hidden="true"></span>
            Enter
          </a>
        </div>

        <div class="hudBottom">
          <div class="hudStat">
            <div class="k">Preview</div>
            <div class="v" id="hudMeta">Image → Video</div>
          </div>
          <div class="hudTip">Drag to spin<br/>Scroll to flick<br/>Tap twice on mobile</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== CONFIG ======
    const WHATSAPP_NUMBER = "447483849357";
    const vibes = [
      { key:"gym",     label:"GYM",     sub:"FOCUS", page:"gym.html",     img:"assets/gym.jpg",     vid:"assets/gym.mp4",     desc:"High focus. Clean fuel. No distractions." },
      { key:"lockin",  label:"LOCK-IN", sub:"GRIND", page:"lock-in.html", img:"assets/lockin.jpg",  vid:"assets/lockin.mp4",  desc:"Tunnel vision mode. Phone down. Get it done." },
      { key:"work",    label:"WORK",    sub:"DAY",   page:"work.html",    img:"assets/work.jpg",    vid:"assets/work.mp4",    desc:"Clean energy. Smooth day. No crash." },
      { key:"gaming",  label:"GAMING",  sub:"NIGHT", page:"gaming.html",  img:"assets/gaming.jpg",  vid:"assets/gaming.mp4",  desc:"Locked in. Fast hands. Zero tilt." },
      { key:"mystery", label:"MYSTERY", sub:"DROP",  page:"mystery.html", img:"assets/mystery.jpg", vid:"assets/mystery.mp4", desc:"Random pull. Premium chaos (in a good way)." },
      { key:"fresh",   label:"FRESH",   sub:"CLEAN", page:"fresh.html",   img:"assets/fresh.jpg",   vid:"assets/fresh.mp4",   desc:"Light, clean, refreshing. Reset the day." },
    ];
    const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

    document.getElementById("waTop").href =
      `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent("Hi Snack Packz — I want to place an order.")}`;

    // ====== DOM ======
    const wheelZone = document.getElementById("wheelZone");
    const wheelImg  = document.getElementById("wheelImg");
    const markers   = document.getElementById("markers");
    const heatRing  = document.getElementById("heatRing");
    const sparkRing = document.getElementById("sparkRing");

    const resetBtn  = document.getElementById("resetBtn");
    const boostBtn  = document.getElementById("boostBtn");
    const brakeBtn  = document.getElementById("brakeBtn");
    const autoBtn   = document.getElementById("autoBtn");

    const spdVal    = document.getElementById("spdVal");
    const peakVal   = document.getElementById("peakVal");
    const rankTxt   = document.getElementById("rankTxt");

    const speedCanvas = document.getElementById("speedCanvas");
    const sctx = speedCanvas.getContext("2d");

    const hudMedia = document.getElementById("hudMedia");
    const hudImg   = document.getElementById("hudImg");
    const hudVid   = document.getElementById("hudVid");
    const hudTitle = document.getElementById("hudTitle");
    const hudDesc  = document.getElementById("hudDesc");
    const hudMeta  = document.getElementById("hudMeta");
    const enterBtn = document.getElementById("enterBtn");

    // ====== PREVIEW (image instantly → video fade when ready) ======
    let videoToken = 0;
    function loadPreview(v){
      hudTitle.textContent = v.label;
      hudDesc.textContent  = v.desc;
      enterBtn.href = v.page;

      hudMedia.classList.remove("ready");
      hudMeta.textContent = "Image → Video";
      hudImg.src = v.img;

      const t = ++videoToken;
      try{ hudVid.pause(); }catch(e){}
      hudVid.removeAttribute("src");
      hudVid.load();
      hudVid.src = v.vid;

      const onReady = ()=>{
        if (t !== videoToken) return;
        hudMedia.classList.add("ready");
        hudMeta.textContent = "Video ready";
        try{ hudVid.play().catch(()=>{}); }catch(e){}
      };
      const onErr = ()=>{
        if (t !== videoToken) return;
        hudMedia.classList.remove("ready");
        hudMeta.textContent = "Video unavailable (image only)";
      };

      hudVid.addEventListener("loadeddata", onReady, {once:true});
      hudVid.addEventListener("canplaythrough", onReady, {once:true});
      hudVid.addEventListener("error", onErr, {once:true});
      hudVid.load();
    }

    // ====== MARKERS ======
    const N = vibes.length;
    function buildMarkers(){
      markers.innerHTML = "";
      const radiusPct = 52;
      for (let i=0; i<N; i++){
        const m = document.createElement("div");
        m.className = "marker";
        m.dataset.index = String(i);
        m.style.width = (vibes[i].label.length > 6 ? 150 : 130) + "px";
        const deg = (i*(360/N)) - 90;
        m.style.transform = `rotate(${deg}deg) translateX(${radiusPct}%)`;
        m.innerHTML = `
          <span class="mDot"></span>
          <span class="mTxt">${vibes[i].label}</span>
          <span class="mSub">${vibes[i].sub}</span>
        `;

        m.addEventListener("mouseenter", ()=>{
          if (window.matchMedia("(hover:hover)").matches){
            setActive(i, false);
          }
        });

        m.addEventListener("click", (e)=>{
          e.preventDefault();
          const idx = Number(m.dataset.index);

          // mobile: tap once preview, second tap enter
          if (window.matchMedia("(hover:none)").matches){
            if (activeIndex === idx && m.classList.contains("active")){
              window.location.href = vibes[idx].page;
              return;
            }
            setActive(idx, true);
            return;
          }

          setActive(idx, true);
        }, {passive:false});

        markers.appendChild(m);
      }
      updateMarkerActive();
    }
    function updateMarkerActive(){
      markers.querySelectorAll(".marker").forEach(el=>el.classList.remove("active"));
      const el = markers.querySelector(`.marker[data-index="${activeIndex}"]`);
      if (el) el.classList.add("active");
    }

    // ====== WHEEL PHYSICS ======
    let rot = 0;          // degrees
    let vel = 0;          // deg/sec
    let dragging = false;
    let pointerId = null;
    let lastAng = 0;
    let lastT = 0;

    let activeIndex = 0;
    let autoSpin = false;
    let peak = 0;

    const step = 360 / N;
    const normDeg = d => ((d%360)+360)%360;

    function nearestIndex(){
      const r = normDeg(rot);
      let i = Math.round((-r) / step);
      i = ((i%N)+N)%N;
      return i;
    }
    function snapToIndex(i){
      const target = -i * step;
      let diff = target - rot;
      diff = ((diff + 540) % 360) - 180;
      rot += diff;
      vel = 0;
    }
    function setActive(i, snap=true){
      activeIndex = i;
      updateMarkerActive();
      loadPreview(vibes[i]);
      if (snap) snapToIndex(i);
    }

    function angleFromEvent(e){
      const rect = wheelZone.getBoundingClientRect();
      const cx = rect.left + rect.width/2;
      const cy = rect.top + rect.height/2;
      const dx = e.clientX - cx;
      const dy = e.clientY - cy;
      return Math.atan2(dy, dx) * 180 / Math.PI;
    }

    function onDown(e){
      dragging = true;
      pointerId = e.pointerId;
      wheelZone.setPointerCapture?.(pointerId);
      lastAng = angleFromEvent(e);
      lastT = performance.now();
    }
    function onMove(e){
      if (!dragging || e.pointerId !== pointerId) return;
      const a = angleFromEvent(e);
      let da = a - lastAng;
      if (da > 180) da -= 360;
      if (da < -180) da += 360;

      rot += da;

      const now = performance.now();
      const dt = Math.max(1, (now - lastT)) / 1000;
      const v = da / dt;
      vel = vel*0.75 + v*0.25;

      lastAng = a;
      lastT = now;

      const idx = nearestIndex();
      if (idx !== activeIndex){
        activeIndex = idx;
        updateMarkerActive();
        loadPreview(vibes[idx]);
      }
    }
    function onUp(e){
      if (!dragging || e.pointerId !== pointerId) return;
      dragging = false;
      pointerId = null;
      setTimeout(()=> setActive(nearestIndex(), true), 70);
    }
    function onWheel(e){
      e.preventDefault();
      const delta = e.deltaY || 0;
      const add = clamp(delta * 0.16, -35, 35);
      rot += add;
      vel += add * 6;

      const idx = nearestIndex();
      if (idx !== activeIndex){
        activeIndex = idx;
        updateMarkerActive();
        loadPreview(vibes[idx]);
      }

      clearTimeout(onWheel._t);
      onWheel._t = setTimeout(()=> setActive(nearestIndex(), true), 110);
    }

    // ====== SPEEDOMETER (Canvas, clean) ======
    function fitCanvas(){
      const rect = speedCanvas.getBoundingClientRect();
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      speedCanvas.width = Math.round(rect.width * dpr);
      speedCanvas.height = Math.round(rect.height * dpr);
    }

    function drawSpeed(speed, peakSpeed){
      const w = speedCanvas.width, h = speedCanvas.height;
      sctx.clearRect(0,0,w,h);

      const cx = w*0.58, cy = h*0.70;
      const R  = Math.min(w,h)*0.46;

      // panel bg
      const bg = sctx.createRadialGradient(cx, cy, R*0.15, cx, cy, R*1.2);
      bg.addColorStop(0, "rgba(255,255,255,0.06)");
      bg.addColorStop(0.45, "rgba(0,0,0,0.30)");
      bg.addColorStop(1, "rgba(0,0,0,0.65)");
      sctx.fillStyle = bg;
      sctx.fillRect(0,0,w,h);

      const start = Math.PI*0.80;
      const end   = Math.PI*2.18;
      const span  = end - start;

      // track arc
      sctx.lineCap = "round";
      sctx.lineWidth = Math.max(10, R*0.075);
      sctx.strokeStyle = "rgba(255,255,255,0.10)";
      sctx.beginPath(); sctx.arc(cx,cy,R,start,end); sctx.stroke();

      const pct = clamp(speed/100, 0, 1);
      const grad = sctx.createLinearGradient(cx-R, cy, cx+R, cy);
      grad.addColorStop(0, "rgba(155,231,255,0.85)");
      grad.addColorStop(0.55, "rgba(183,168,255,0.75)");
      grad.addColorStop(1, "rgba(255,106,61,0.90)");

      // speed arc glow
      sctx.strokeStyle = grad;
      sctx.shadowColor = "rgba(255,106,61,0.18)";
      sctx.shadowBlur  = 26;
      sctx.beginPath(); sctx.arc(cx,cy,R,start,start+span*pct); sctx.stroke();
      sctx.shadowBlur = 0;

      // needle
      const a = start + span*pct;
      const nx = cx + Math.cos(a)*R*0.78;
      const ny = cy + Math.sin(a)*R*0.78;

      sctx.strokeStyle = "rgba(255,255,255,0.85)";
      sctx.lineWidth = 5;
      sctx.beginPath(); sctx.moveTo(cx,cy); sctx.lineTo(nx,ny); sctx.stroke();

      sctx.strokeStyle = "rgba(255,106,61,0.22)";
      sctx.lineWidth = 11;
      sctx.beginPath(); sctx.moveTo(cx,cy); sctx.lineTo(nx,ny); sctx.stroke();

      // centre cap
      const cap = sctx.createRadialGradient(cx-10, cy-12, 6, cx, cy, 30);
      cap.addColorStop(0,"rgba(255,255,255,0.22)");
      cap.addColorStop(0.55,"rgba(155,231,255,0.08)");
      cap.addColorStop(1,"rgba(0,0,0,0.70)");
      sctx.fillStyle = cap;
      sctx.beginPath(); sctx.arc(cx,cy, 22, 0, Math.PI*2); sctx.fill();

      // digits left
      sctx.fillStyle = "rgba(238,243,255,0.92)";
      sctx.font = `900 ${Math.round(h*0.34)}px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto`;
      sctx.textAlign = "left";
      sctx.textBaseline = "middle";
      sctx.fillText(String(Math.round(speed)), w*0.08, h*0.30);

      sctx.fillStyle = "rgba(238,243,255,0.62)";
      sctx.font = `900 ${Math.round(h*0.07)}px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto`;
      sctx.fillText("SPIN / SEC", w*0.08, h*0.41);

      // peak mini bar
      const p = clamp(peakSpeed/100, 0, 1);
      const bx = w*0.08, by = h*0.50, bw = w*0.40, bh = Math.max(10, h*0.045);
      sctx.fillStyle = "rgba(255,255,255,0.10)";
      sctx.beginPath();
      sctx.roundRect ? sctx.roundRect(bx,by,bw,bh,999) : sctx.rect(bx,by,bw,bh);
      sctx.fill();

      sctx.fillStyle = "rgba(255,106,61,0.55)";
      sctx.beginPath();
      sctx.roundRect ? sctx.roundRect(bx,by,bw*p,bh,999) : sctx.rect(bx,by,bw*p,bh);
      sctx.fill();

      sctx.fillStyle = "rgba(238,243,255,0.65)";
      sctx.font = `850 ${Math.round(h*0.06)}px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto`;
      sctx.fillText("Peak", bx+bw+12, by+bh/2);

      sctx.fillStyle = "rgba(238,243,255,0.92)";
      sctx.font = `950 ${Math.round(h*0.07)}px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto`;
      sctx.fillText(String(Math.round(peakSpeed)), bx+bw+62, by+bh/2);
    }

    function setSpeedUI(speed){
      spdVal.textContent = String(Math.round(speed));
      peak = Math.max(peak, speed);
      peakVal.textContent = String(Math.round(peak));

      let rank = "Warm";
      if (speed >= 25) rank = "Hot";
      if (speed >= 50) rank = "Flame";
      if (speed >= 75) rank = "Overdrive";
      rankTxt.textContent = "Rank: " + rank;

      heatRing.classList.toggle("on", speed >= 45);
      sparkRing.classList.toggle("on", speed >= 60);
    }

    // ====== LOOP ======
    let lastFrame = performance.now();
    function tick(now){
      const dt = Math.min(0.05, (now - lastFrame)/1000);
      lastFrame = now;

      if (autoSpin) vel += 380 * dt;

      if (!dragging){
        rot += vel * dt;
        vel *= Math.exp(-3.0 * dt);

        if (Math.abs(vel) < 20){
          const idx = nearestIndex();
          const target = -idx * step;
          let diff = target - rot;
          diff = ((diff + 540) % 360) - 180;
          rot += diff * Math.min(1, dt*8);

          if (idx !== activeIndex){
            activeIndex = idx;
            updateMarkerActive();
            loadPreview(vibes[idx]);
          }
        }
      }

      wheelImg.style.setProperty("--rot", `${rot}deg`);

      // deg/sec -> spins/sec -> scaled to 0..100
      const spinsPerSec = Math.abs(vel) / 360;
      const speed = clamp(spinsPerSec * 85, 0, 100);

      setSpeedUI(speed);
      drawSpeed(speed, peak);

      requestAnimationFrame(tick);
    }

    // ====== BUTTONS ======
    resetBtn.addEventListener("click", ()=>{
      autoSpin = false;
      vel = 0; peak = 0;
      setActive(0, true);
    });
    boostBtn.addEventListener("click", ()=>{ vel += 1600; });
    brakeBtn.addEventListener("click", ()=>{
      autoSpin = false;
      vel *= 0.12;
      setTimeout(()=> setActive(nearestIndex(), true), 80);
    });
    autoBtn.addEventListener("click", ()=>{
      autoSpin = !autoSpin;
      autoBtn.textContent = autoSpin ? "Auto: ON" : "Auto";
    });

    // ====== INIT ======
    buildMarkers();
    loadPreview(vibes[0]);
    setActive(0, true);

    wheelZone.addEventListener("pointerdown", onDown, {passive:true});
    window.addEventListener("pointermove", onMove, {passive:true});
    window.addEventListener("pointerup", onUp, {passive:true});
    wheelZone.addEventListener("wheel", onWheel, {passive:false});

    function onResize(){ fitCanvas(); }
    window.addEventListener("resize", onResize);
    fitCanvas();

    requestAnimationFrame(tick);
  </script>
</body>
</html>
